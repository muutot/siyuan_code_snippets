[
  {
    "id": "20250816212926-0000001",
    "name": "blocking-arsi_behavior-color",
    "type": "css",
    "enabled": true,
    "content": ".content.svelte-1np61ga.svelte-1np61ga {\n    background-color: #1F1F1F;\n}\n"
  },
  {
    "id": "20250816212926-0000002",
    "name": "blocking-arsi_behavior-content_block",
    "type": "css",
    "enabled": true,
    "content": ".protyle-wysiwyg[data-readonly=false] [data-node-id].asri-selected-block:not(#plugin-focus-unique-id,[data-plugin-focus=true])::before {\n    content: none; /* å±è”½Asriæ¯è¡Œå‰é¢çš„å…‰æ ‡ */\n}\n"
  },
  {
    "id": "20250816212926-0000003",
    "name": "blocking-arsi_behavior-file_tree",
    "type": "css",
    "enabled": true,
    "content": "body:not(.body-asri--mobile,.body-asri--android,.body-asri--iosApp) .file-tree:where(.sy__file,.sy__outline,.sy__bookmark,.sy__tag,.sy__backlink) .block__icons::before {\n    content: none;\n}\n\nbody:not(.body-asri--mobile,.body-asri--android,.body-asri--iosApp) .file-tree:where(.sy__file,.sy__outline,.sy__bookmark,.sy__tag,.sy__backlink) .block__icons > :where(div,span) {\n    transform: none;\n    transition: auto;\n    opacity: 1 !important;\n}\n\nbody:not(.body-asri--mobile,.body-asri--android,.body-asri--iosApp) .file-tree:where(.sy__file,.sy__outline,.sy__bookmark,.sy__tag,.sy__backlink) .block__icons:hover, body:not(.body-asri--mobile,.body-asri--android,.body-asri--iosApp) .file-tree:where(.sy__file,.sy__outline,.sy__bookmark,.sy__tag,.sy__backlink) .block__icons:focus-within, .block__icons {\n    height: 30px !important;\n}\n"
  },
  {
    "id": "20250816212926-0000004",
    "name": "blocking-arsi_behavior-tab_bar",
    "type": "css",
    "enabled": true,
    "content": "/* å±è”½ Asri éªšæ“ä½œ*/\n.layout-tab-bar .item:not(.item--pin,.item--focus) .item__icon, .layout-tab-bar .item:not(.item--pin,.item--focus) .item__icon + .item__text {\n    transform: none;\n}\n\n.layout-tab-bar .item:not(.item--pin,.item--focus) .item__text {\n    transform: none;\n}\n"
  },
  {
    "id": "20250816212926-0000005",
    "name": "main-background",
    "type": "css",
    "enabled": true,
    "content": "body {\n    background-image: url('public/background/frosted_win.jpg') !important;\n    background-position: center;\n    background-repeat: no-repeat;\n    background-size: cover;\n}\n\n/* é€æ˜åŒ–å·¥ä½œåŒº */\n.layout-tab-container, /* ç¼–è¾‘åŒº */\n.protyle, /* å¤§çº², æ–‡æ¡£æ ‘ */\n.protyle-breadcrumb, /* é¢åŒ…å±‘ */\n.fn__flex-column[data-type=wnd] > .fn__flex:first-child /* æ ‡ç­¾é¡µæ  */\n{\n    background-color: #00000000 !important;\n}\n"
  },
  {
    "id": "20250816212926-0000006",
    "name": "main-doc_title",
    "type": "css",
    "enabled": true,
    "content": ".protyle-background__ia {\n    margin-left: 20px !important;\n}\n\n/* æ–‡æ¡£å†…å®¹æ ‡é¢˜ æŠ¬å¤´ */\n.protyle-top > .protyle-title.protyle-wysiwyg--attr {\n    position: absolute;\n    top: 0;\n    left: 20%;\n    width: 76%;\n    font-size: 14px !important;\n}\n\n.protyle-title__input {\n    margin-top: 0; /* æŠµæ¶ˆä¸»é¢˜çš„cssé…ç½® (Asri) */\n}\n\n.protyle-title {\n    margin: 5px 0 0 10px !important;\n    width: 100%;\n    font-size: 1.3em;\n    top: 8px;\n    height: 100px;\n    left: 3%;\n    display: inline-block;\n    position: relative;\n    color: red;\n}\n\n/* é—®å¾—æ ‡é¢˜å›¾æ ‡ */\n.protyle-background__icon img, .protyle-background__icon svg {\n    height: auto;\n    width: auto;\n    float: none;\n    border-radius: unset;\n}\n\n.protyle-top {\n    padding-bottom: 15px;\n    position: relative;\n    border-bottom: 2px solid;\n    border-color: transparent; /* è¾¹æ¡†é¢œè‰²è®¾ç½®ä¸ºé€æ˜ */\n    border-image: linear-gradient(to right, #d2a5e9, #e11919, #19ff00) 1;\n    border-radius: 0;\n    min-height: 96px; /* å ä½å›¾æ ‡é«˜åº¦ */\n    max-width: 80%;\n    left: 10%;\n    display: flex;\n}\n\n.protyle-top .protyle-background__action {\n    display: inline-grid;\n    left: -1%;\n    width: 17%;\n}\n\n.protyle-top .protyle-background__img img {\n    max-height: 100px;\n}\n\n.protyle-too .protyle-background.protyle-background--enable {\n    width: 100%;\n}\n\n/* æŒ‰é’®ä½ç½® */\nbody:not(.body-asri--mobile) .protyle-background:not(.without-icon) .protyle-background__img.fn__none + .protyle-background__ia .protyle-background__action {\n    top: 18px;\n    left: 128px;\n    --y: 0;\n    --x: 0;\n    display: block;\n}\n"
  },
  {
    "id": "20250816212926-0000007",
    "name": "main-editor_area",
    "type": "css",
    "enabled": true,
    "content": "/* ç¼–è¾‘åŒºå¡«å…… */\n.protyle-wysiwyg {\n    padding: 25px 50px 285px !important;\n}\n\n.protyle-wysiwyg span[data-type~=em], .protyle-wysiwyg em {\n    font-family: \"Maple Mono NF CN\", serif;\n}\n\n.protyle-title.protyle-wysiwyg--attr {\n    margin: 5px 50px 0 !important;\n}\n"
  },
  {
    "id": "20250816212926-0000008",
    "name": "main-main",
    "type": "css",
    "enabled": true,
    "content": ":root {\n    --b3-theme-background: #1e1e1e;\n    --b3-theme-background-light: rgba(255, 255, 255, .075);\n    --b3-theme-surface: #2b2b2b;\n    --b3-font-family: \"yahei consolas hybrid\", \"Maple Mono NF CN\", system-ui, ui-sans-serif, -apple-system, BlinkMacSystemFont, \"SF Pro SC\", \"SF Pro Text\", \"SF Pro Icons\", \"Helvetica Neue\", \"Luxi Sans\", \"DejaVu Sans\", \"PingFang SC\", \"Segoe UI\", \"Microsoft Yahei\", \"Hiragino Sans GB\", sans-serif, \"Segoe UI Emoji\", \"Noto Color Emoji\", \"Segoe UI Symbol\", \"Android Emoji\", \"EmojiSymbols\" !important;\n}\n\n\n\n.b3-typography:not(.b3-typography--default),\n.protyle-wysiwyg,\n.protyle-title {\n    font-family: \"yahei consolas hybrid\", \"Maple Mono NF CN\", system-ui, ui-sans-serif, -apple-system, BlinkMacSystemFont,\n    \"SF Pro SC\", \"SF Pro Text\", \"SF Pro Icons\", \"Helvetica Neue\", \"Luxi Sans\", \"DejaVu Sans\", \"PingFang SC\", \"Segoe UI\",\n    \"Microsoft Yahei\", \"Hiragino Sans GB\", sans-serif, \"Segoe UI Emoji\", \"Noto Color Emoji\", \"Segoe UI Symbol\", \"Android Emoji\", \"EmojiSymbols\" !important;\n}\n\nbody:not(.body-asri--mobile,.body--window) {\n    --toolbar-height: 32px;\n    --toolbar-height-self: 32px;\n    --topbar-z-index: 2;\n    --avoid-topbar-self: var(--toolbar-height-self);\n}\n\nbody:not(.body-asri--mobile,.body--window) .layout__center .layout-tab-bar:not(body:not(.body-asri--mobile,.body--window) .layout__center .layout-tab-bar--readonly) {\n    margin-top: 4px;\n    margin-right: 4px;\n}\n\nbody:not(.body-asri--mobile,.body--window) .layout__center .layout-tab-bar--readonly {\n    margin-left: 0;\n    margin-top: 4px;\n    margin-right: 4px;\n\n    & .item {\n        min-height: 28px;\n    }\n}\n"
  },
  {
    "id": "20250816212926-0000009",
    "name": "main-status_bar",
    "type": "css",
    "enabled": true,
    "content": "body:not(.body-asri--mobile) #dockBottom.fn__none:not(.has-layout-dockb-float) ~ #status .status__msg:not(:empty) {\n    max-width: 1920px;\n}\n"
  },
  {
    "id": "20250816212926-0000010",
    "name": "main-toolbar",
    "type": "css",
    "enabled": true,
    "content": "/* toolbar */\n#layouts > div.fn__flex.fn__flex-1 > div.layout__center.fn__flex.fn__flex-1 > div > div > div.fn__flex {\n    background-color: #161616;\n}\n\n#AsriPluginsIconsDivider {\n    top: 5px !important;\n}\n\n.fn__flex-column[data-type=wnd] > .fn__flex:first-child {\n    height: var(--toolbar-height-self);\n}\n\n/* æ ‡ç­¾é…ç½® */\n.layout-tab-bar .item {\n    height: 22px;\n    min-height: 28px;\n    padding: 0;\n}\n\n/* ä¸»èœå•å›¾æ ‡ */\n#toolbar #barWorkspace {\n    background-color: rgba(0, 0, 0, 0);\n    color: var(--b3-theme-on-surface);\n    font-weight: 500;\n    font-size: 6px;\n    height: 22px;\n    position: relative;\n    margin-top: 4px;\n    margin-bottom: 4px;\n    outline: 1px solid var(--b3-border-color-trans);\n    outline-offset: -1px;\n}\n\n/* å±è”½ä¸»èœå•å‘ä¸‹ç®­å¤´ */\n#barWorkspace > svg {\n    display: none;\n}\n\nbody:not(.body-asri--mobile,.body--window) .layout__dockl > .fn__flex:not(.fn__none):first-child .layout-tab-container,\nbody:not(.body-asri--mobile,.body--window) .layout__dockl > .fn__flex.fn__none ~ .fn__flex .layout-tab-container,\nbody:not(.body-asri--mobile,.body--window) .layout__dockr > .fn__flex:not(.fn__none):first-child .layout-tab-container,\nbody:not(.body-asri--mobile,.body--window) .layout__dockr > .fn__flex.fn__none ~ .fn__flex .layout-tab-container {\n    padding-top: var(--avoid-topbar-self);\n}\n\n/* å±è”½æ ‡ç­¾é¡µ x å· */\n.layout-tab-bar span.item__close {\n    display: none;\n}\n\n/* å›¾æ ‡å¤§å° ä½ç½® */\n.layout-tab-bar .item__icon > img, .layout-tab-bar .item__icon > svg {\n    height: 14px;\n    width: 14px;\n    margin-top: 0;\n}\n\n/* å³ä¾§åŠŸèƒ½å›¾æ ‡ä½ç½® */\ndiv#AsriTopbarRightSpacing {\n    max-width: 18px;\n}\n\n/* é¢åŒ…å±‘ */\n.protyle-breadcrumb {\n    height: 30px;\n}\n"
  },
  {
    "id": "20250816212926-0000011",
    "name": "markdown-code",
    "type": "css",
    "enabled": true,
    "content": "/* å­—ä½“ */\n:root {\n    --b3-font-family-code: 'ibm plex mono', 'yahei consolas hybrid';\n}\n\n/* ä»£ç å— è¡Œé«˜åº¦ */\n.code-block .hljs > span {\n    line-height: 19px;\n}\n\n/* åˆ—è¡¨ä¸‹ è·ç¦»å·¦ä¾§è·ç¦» */\ndiv.li .code-block {\n    left: 30px;\n}\n\n.protyle-wysiwyg .code-block {\n    --b3-protyle-code-linenumber-hl: color-mix(in srgb, var(--b3-theme-surface) 55%, var(--b3-theme-primary));\n    margin: .4em 0 1em 0 !important; /* bottom è¿ç»­ä»£ç å—ç»™å‘½åè…¾å‡ºä¸ªåœ°æ–¹ */\n    padding: 0.3em 0.2em 0.3em 0.2em !important;\n}\n\n/* ä»£ç å—æ•´ä½“ é»˜è®¤è®¾ç½®å­˜åœ¨è¡Œå·*/\n.protyle-wysiwyg .code-block .hljs {\n    padding: 0.3em 0.2em 0.3em 0.2em;\n    background-color: var(--b3-code-block-backgroud-color);\n    /* margin-left: 2.2em; æ²¡æœ‰è¡Œå·çš„æ—¶å€™æ¸…ç©ºæ ·å¼ */\n    position: inherit;\n    max-height: 550px; /* è®¾ç½®å•ä¸€ä»£ç å—æœ€å¤§é«˜åº¦ */\n}\n\n/* éšè—ä»£ç å—å å»é™¤ä¸Šé¢çš„ padding å’Œ maring æ˜¾ç¤ºç¬¬ä¸€è¡Œä»£ç  */\n.protyle-wysiwyg .code-block[fold=\"1\"] .hljs {\n    padding-top: 0;\n    margin-top: 0;\n}\n\n/* è¡Œå· */\n.protyle-wysiwyg .code-block .protyle-linenumber__rows {\n    padding-top: 0px;\n    font-size: 12px;\n    width: 2.2em;\n}\n\n/* æ ‡é¢˜æ  */\n.protyle-wysiwyg[data-readonly=false] .code-block .protyle-action {\n    -webkit-user-modify: read-only;\n    /* ä¿®å¤ç¬¬ä¸€è¡Œä»£ç ä¸å¯ç‚¹å‡» ä¿®å¤å -> å‰85%çš„ä½ç½®å¯ä»¥ç‚¹å‡» */\n    position: absolute;\n    left: 95%;\n    top: 0;\n}\n\n/* è¯­è¨€é€‰æ‹©æ  */\n.code-block .protyle-action .protyle-action__language {\n    -webkit-user-modify: read-only;\n    margin-top: 0;\n    position: absolute;\n    right: inherit;\n    float: right;\n    width: 90px;\n    padding-left: 0;\n    margin-left: 0;\n    margin-right: 4em;\n    text-align: right;\n}\n\n/* å¤åˆ¶æŒ‰é’® */\n.protyle-action .protyle-action__copy {\n    border-top-left-radius: 8px;\n    border-bottom-left-radius: 8px;\n    /*border-radius: 8px;*/\n    padding-left: 6px;\n}\n\n/* å¤åˆ¶æŒ‰é’® æŠ˜å æŒ‰é’® */\n.protyle-action .protyle-icon--expand {\n    border-top-right-radius: 8px;\n    border-bottom-right-radius: 8px;\n}\n\n/* æ›´å¤šæŒ‰é’® */\n.protyle-action .protyle-icon--last {\n    display: none;\n}\n\n/* å±æ€§å */\n.code-block > .protyle-attr {\n    top: -16px;\n}\n\n.protyle-wysiwyg [data-node-id][fold=\"1\"]:not(.li):not([data-type=NodeHeading]) {\n    opacity: 1;\n}\n\n.protyle-wysiwyg [data-node-id][fold=\"1\"]:not(.li):not([data-type=NodeHeading]) .protyle-attr {\n    opacity: 1;\n    top: -16px;\n}\n\n/* ä»£ç ä¸»é¢˜è®¾ç½® */\n.hljs {\n    color: #EEBEFA;\n    background-color: #2b2d30;\n    font-weight: 500;\n    margin-top: 3px;\n}\n\n.hljs-keyword {\n    color: #2091F6;\n}\n\n.hljs-string {\n    color: #827CDA;\n}\n\n.hljs-attr {\n    color: #40CFDC;\n}\n\n.class_ {\n    color: #fa2aad;\n}\n\n.hljs-title.class_ {\n    color: #fa2aad;\n}\n\n.hljs-type {\n    color: #FF7575;\n}\n\n.function_ {\n    color: #1DF528;\n}\n\n.hljs-title.function_ {\n    color: #1DF528;\n}\n\n.hljs-params {\n    color: #45ee8c;\n}\n\n.hljs-comment {\n    color: #808080;\n}\n\n.hljs-built_in {\n    color: #00CCCC;\n}\n\n.hljs-attribute {\n    color: gold;\n}\n\n.hljs-selector-class {\n    color: #ffa07a;\n}\n\n.hljs-selector-tag {\n    color: #ea51b2;\n}\n\n.hljs-meta {\n    color: #00f769;\n}\n"
  },
  {
    "id": "20250816212926-0000012",
    "name": "markdown-comment",
    "type": "css",
    "enabled": true,
    "content": "[data-theme-mode=dark] .protyle-wysiwyg span[data-type~=inline-memo]:hover {\n    color: #fdfae8 !important; /* é¼ æ ‡ç§»åˆ°ç„¦ç‚¹åä¸‹åˆ’çº¿é¢œè‰² */\n    background-color: rgba(0, 0, 0, 0);\n    box-shadow: none;\n}\n\n[data-theme-mode=dark] .protyle-wysiwyg span[data-type~=inline-memo] {\n    text-decoration-color: #00c2ff; /* é»˜è®¤ä¸‹åˆ’çº¿é¢œè‰² */\n}\n\n[data-theme-mode=dark] .tooltip--memo#tooltip {\n    margin-top: 3px;\n    margin-left: 3px;\n    background-color: #2e3236;\n    color: #c78eda;\n}\n\n[data-theme-mode=dark] .protyle-wysiwyg--attr .protyle-attr > div:not(.protyle-attr--memo):not(.protyle-attr--refcount) {\n    color: #00b6ff;\n}\n\n.protyle-wysiwyg [data-node-id] span[data-type~=block-ref]:not(.av__celltext), .protyle-wysiwyg [data-node-id] span[data-type~=file-annotation-ref] {\n    color: #6791f3;\n}\n"
  },
  {
    "id": "20250816212926-0000013",
    "name": "markdown-content",
    "type": "css",
    "enabled": true,
    "content": "/* åŠ ç²—æ–‡æœ¬é¢œè‰² */\n.protyle-wysiwyg span[data-type~=strong],\n.protyle-wysiwyg strong {\n    color: #fbd80e;\n}\n\n.protyle-wysiwyg [data-node-id].li > .list {\n    margin-left: 10px !important;\n    padding-left: 35px;\n    padding-top: 0;\n    padding-bottom: 0\n}\n\n/* æ–‡æ¡£ä¸Šé¢çš„é—´è· */\nbody:not(.body--mobile) .protyle-background .protyle-background__img.fn__none + .protyle-background__ia {\n    margin-top: 0;\n    padding-top: 0;\n}\n\n/* æ–‡æ¡£å‰ç¼€è¡¨æƒ… */\n.b3-typography img.emoji, .protyle-wysiwyg img.emoji {\n    width: 24px;\n    cursor: auto;\n    vertical-align: middle;\n    margin-right: 2px;\n    margin-left: -3px;\n}\n"
  },
  {
    "id": "20250816212926-0000014",
    "name": "markdown-label",
    "type": "css",
    "enabled": true,
    "content": ".b3-chip--secondary, .b3-chip--primary, .b3-chip--info, .b3-chip--success,\n.b3-chip--warning, .b3-chip--error, .b3-chip--pink {\n    mix-blend-mode: normal !important;\n}\n\n.b3-chip--secondary::before,\n.b3-chip--primary::before,\n.b3-chip--info::before,\n.b3-chip--success::before,\n.b3-chip--warning::before,\n.b3-chip--error::before,\n.b3-chip--pink::before {\n    content: \"#\" !important;\n    margin-right: 5px; /* # å·è·ç¦»æ–‡å­—çš„è·ç¦» */\n}\n\n/* å½“é¼ æ ‡ç§»åŠ¨åˆ°æ ‡ç­¾çš„æ—¶å€™ ç»™xè…¾å‡ºç©ºé—´ ä¸æ˜¾ç¤ºå‰é¢çš„`#` */\n.b3-chip--secondary:hover::before,\n.b3-chip--primary:hover::before,\n.b3-chip--info:hover::before,\n.b3-chip--success:hover::before,\n.b3-chip--warning:hover::before,\n.b3-chip--error:hover::before,\n.b3-chip--pink:hover::before {\n    content: \"\" !important;\n}\n\n.protyle-background__ia .b3-chips {\n    margin-top: 18px;\n    padding: 0 0 0 0;\n}\n\n.protyle-background .b3-chip--secondary {\n    color: #fff !important;\n    background-color: #d6ff0070 !important;\n}\n\n.protyle-background .b3-chip--primary {\n    color: #fff !important;\n    background-color: #0053f9c4 !important;\n}\n\n.protyle-background .b3-chip--info {\n    color: var(--b3-card-info-color) !important;\n    background-color: #28405c !important;\n}\n\n.protyle-background .b3-chip--success {\n    color: var(--b3-card-success-color) !important;\n    background-color: #425347 !important;\n}\n\n.protyle-background .b3-chip--warning {\n    color: var(--b3-card-warning-color) !important;\n    background-color: #554636 !important;\n}\n\n.protyle-background .b3-chip--error {\n    color: var(--b3-card-error-color) !important;\n    background-color: #442724 !important;\n}\n\n.protyle-background .b3-chip--pink {\n    color: var(--b3-theme-on-secondary) !important;\n    background-color: #ea4aaa96 !important;\n}\n\n/* è¡Œçº§æ ‡ç­¾ */\n.protyle-wysiwyg [data-node-id] span[data-type~=tag] {\n    --tag-color: #df8300;\n    font-size: 85%;\n}\n"
  },
  {
    "id": "20250816212926-0000015",
    "name": "markdown-line_code",
    "type": "css",
    "enabled": true,
    "content": "/* è¡Œçº§ä»£ç  */\n.protyle-wysiwyg span[data-type~=code], .protyle-wysiwyg code:not(.hljs) {\n    color: #00e100;\n    margin-left: 4px;\n    margin-right: 4px;\n    display: ruby;\n}\n\n/* fix è¡Œçº§ä»£ç æ®‹ç•™é—®é¢˜ */\n.b3-typography code:not(.hljs),\n.b3-typography span[data-type~='code'],\n.protyle-wysiwyg code:not(.hljs),\n.protyle-wysiwyg span[data-type~='code'] {\n    word-break: break-all;\n}\n"
  },
  {
    "id": "20250816212926-0000016",
    "name": "markdown-link",
    "type": "css",
    "enabled": true,
    "content": ".protyle-wysiwyg [data-node-id] span[data-type~=a], .protyle-wysiwyg a {\n    color: var(--b3-protyle-inline-link-color);\n    text-decoration-line: underline;\n    text-decoration-thickness: .08em;\n    text-decoration-color: var(--b3-protyle-inline-link-color);\n}\n"
  },
  {
    "id": "20250816212926-0000017",
    "name": "markdown-list",
    "type": "css",
    "enabled": true,
    "content": "\n.b3-typography li > p,\n.b3-typography > p,\n.b3-typography blockquote > p,\n.b3-typography [data-node-id],\n.protyle-wysiwyg li > p,\n.protyle-wysiwyg > p,\n.protyle-wysiwyg blockquote > p,\n.protyle-wysiwyg [data-node-id] {\n    line-height: 26px;\n    padding: 2px 2px 0 0;\n    margin: 0 0;\n    border-radius: var(--b3-border-radius);\n}\n\ndiv.li > div.p > div {\n    margin-top: 1px;\n}\n\ndiv.li > div.p[data-type=\"NodeParagraph\"] > div {\n    margin-top: 2px;\n}\n\n/* æ•ˆæœ: ä¸€çº§åˆ—è¡¨ 1.  äºŒçº§åˆ—è¡¨ 1.1  ä¸‰çº§åˆ—è¡¨ 1.1.1 */\n.list[data-subtype=o] {\n    counter-reset: none;\n}\n\n.protyle-wysiwyg .li[data-subtype=o] > .protyle-action,\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] > .protyle-action,\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] > .protyle-action,\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] > .protyle-action {\n    color: rgba(0, 0, 0, 0) !important;\n}\n\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] > .protyle-action::after,\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] > .protyle-action::after,\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] > .protyle-action::after {\n    display: table;\n}\n\n.protyle-wysiwyg .li[data-subtype=o] {\n    counter-increment: olcounter1;\n\n    & > .protyle-action::after {\n        content: counter(olcounter1, -moz-devanagari) \".\";\n        width: 200px;\n        right: 0;\n        color: violet;\n    }\n}\n\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] {\n    counter-increment: olcounter2;\n\n    & > .protyle-action::after {\n        content: counter(olcounter1, -moz-devanagari) \".\" counter(olcounter2, decimal);\n        color: red;\n    }\n}\n\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] {\n    counter-increment: olcounter3;\n\n    & > .protyle-action::after {\n        content: counter(olcounter1, decimal) \".\" counter(olcounter2, decimal) \".\" counter(olcounter3, decimal);\n        color: greenyellow;\n    }\n}\n\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] {\n    counter-increment: olcounter4;\n\n    & > .protyle-action::after {\n        content: counter(olcounter1, decimal) \".\" counter(olcounter2, decimal) \".\" counter(olcounter3, decimal) \".\" counter(olcounter4, decimal);\n        color: deepskyblue;\n    }\n}\n\n.protyle-wysiwyg .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] .li[data-subtype=o] {\n    counter-increment: olcounter5;\n\n    & > .protyle-action::after {\n        content: counter(olcounter1, decimal) \".\" counter(olcounter2, decimal) \".\" counter(olcounter3, decimal) \".\" counter(olcounter4, decimal) \".\" counter(olcounter5, decimal);\n        color: orange;\n    }\n}\n"
  },
  {
    "id": "20250816212926-0000018",
    "name": "markdown-photo",
    "type": "css",
    "enabled": true,
    "content": "/* å›¾ç‰‡å±…ä¸­ */\n[data-type=\"img\"] {\n    width: 33%;\n    min-width: calc(100% - 0.1em);\n}\n\n/* å»é™¤å›¾ç‰‡åçš„å¤šä½™ç©ºè¡Œ CSSç‰‡æ®µ */\n.b3-typography .img:not([style]), .protyle-wysiwyg .img:not([style]) {\n    display: inline-block;\n}\n"
  },
  {
    "id": "20250816212926-0000019",
    "name": "markdown-refference",
    "type": "css",
    "enabled": true,
    "content": ".bq[data-type=\"NodeBlockquote\"] > .p,\n.bq .p {\n    margin-left: 10px;\n}\n\ndiv.bq {\n    margin-bottom: 6px !important;\n    padding-bottom: 2px !important;\n}\n"
  },
  {
    "id": "20250816212926-0000020",
    "name": "markdown-table",
    "type": "css",
    "enabled": true,
    "content": ":is(.b3-typography,.protyle-wysiwyg) :is([data-node-id].table table), :is(.b3-typography,.protyle-wysiwyg) table {\n    margin-top: 12px;\n}\n\n.table .protyle-attr {\n    top: -6px;\n    font-size: 14px;\n}\n"
  },
  {
    "id": "20250816212926-0000021",
    "name": "markdown-title",
    "type": "css",
    "enabled": true,
    "content": ".protyle-wysiwyg .h1, .protyle-wysiwyg h1 {\n    margin-top: 0.3em;\n    text-align: center;\n    color: red;\n    border-bottom: 2px solid; /* è®¾ç½®ä¸‹è¾¹æ¡†çš„é¢œè‰²å’Œåšåº¦ è¾¹æ¡†é¢œè‰²è®¾ç½®ä¸ºé€æ˜ */\n    border-color: transparent; /* è¾¹æ¡†é¢œè‰²è®¾ç½®ä¸ºé€æ˜ */\n    border-image: linear-gradient(to right, #f00, #00f) 1; /* è®¾ç½®æ¸å˜è¾¹æ¡† */\n    border-radius: 0;\n}\n\n.protyle-wysiwyg .h2, .protyle-wysiwyg h2 {\n    color: #2091F6;\n    margin-top: 0.3em;\n}\n\n.protyle-wysiwyg .h3, .protyle-wysiwyg h3 {\n    color: #8694ff;\n    margin-top: 0.2em;\n}\n\n.protyle-wysiwyg .h4, .protyle-wysiwyg h4 {\n    color: #ffa54b;\n}\n\n.protyle-wysiwyg .h5, .protyle-wysiwyg h5 {\n    color: #9cfd57;\n}\n\n.protyle-wysiwyg .h6, .protyle-wysiwyg h6 {\n    color: #e7fd1a;\n}\n\n/* è¶…çº§å— h2 å³ç§»åŠ¨ä¸€éƒ¨åˆ† */\n.sb > div.h2 {\n    text-align: center;\n}\n"
  },
  {
    "id": "20250816212926-0000022",
    "name": "markdown-siyuan-block_refenerce",
    "type": "css",
    "enabled": true,
    "content": ".protyle-wysiwyg [data-node-id] span[data-type~=block-ref]:not(.av__celltext), .protyle-wysiwyg [data-node-id] span[data-type~=file-annotation-ref] {\n    text-decoration-color: #2f89fd\n}\n"
  },
  {
    "id": "20250816212926-0000023",
    "name": "markdown-siyuan-database",
    "type": "css",
    "enabled": true,
    "content": "/* éšè—é™¤äº†ç‰¹å®šæ•°æ®åº“å—çš„å…¶ä»–ä¸»é”®åˆ— CSSç‰‡æ®µ */\n/* author by JeffreyChen https://ld246.com/article/1728354035172 */\n/* å¯ç”¨ä»£ç ç‰‡æ®µåï¼Œç»™éœ€è¦ä¿ç•™ä¸»é”®çš„æ•°æ®åº“å—æ·»åŠ è‡ªå®šä¹‰å±æ€§ï¼šhide-hpk=false */\n.protyle-wysiwyg .av:not([custom-hpk=false]) [data-dtype=\"block\"] {\n    display: none;\n}\n\n.protyle-wysiwyg .av:not([custom-hpk=false]) .av__calc[data-dtype=\"block\"]:first-child + .av__calc {\n    padding-left: 1.625em;\n    box-sizing: initial;\n}\n\n/* ç¼©å°æ˜¾ç¤ºæ ‡ç­¾ */\nspan.b3-chip {\n    margin-left: 2px !important;\n    font-size: 14px;\n}\n\n/* è¡¨æ ¼å†…å®¹å³å¯¹é½ */\n.av__scroll .av__row .av__cell:not(.av__cell--header) {\n    text-align: right;\n}\n\n/* æŠµæ¶ˆå¤–éƒ¨ Item æ ·å¼ */\ndiv.fn__flex.av__views > div.layout-tab-bar.fn__flex .item {\n    margin-bottom: 0;\n}\n\n\n/* å±è”½åˆ—æ ‡é¢˜ ç±»åˆ«å›¾æ ‡ */\n.av__row--header .av__cellheadericon {\n    display: none;\n}\n"
  },
  {
    "id": "20250816212926-0000024",
    "name": "markdown-siyuan-super_block",
    "type": "css",
    "enabled": true,
    "content": "/* äºŒçº§è¶…çº§å— æ·»åŠ è¾¹æ¡† */\n\n.protyle-wysiwyg .sb {\n    margin: 4px 8px 8px 4px !important;\n\n\n    & .p {\n        margin-left: 10px;\n    }\n}\n\n.protyle-wysiwyg [data-node-id].sb[data-sb-layout=col] > div {\n    margin-right: 0;\n}\n"
  },
  {
    "id": "20250816212926-0000025",
    "name": "miscellaneous-plugin",
    "type": "css",
    "enabled": true,
    "content": ".self_cloud {\n    width: 450px;\n    height: 35px;\n}\n"
  },
  {
    "id": "20250816212926-0000026",
    "name": "miscellaneous-search",
    "type": "css",
    "enabled": true,
    "content": "#searchList [data-type=search-item] .b3-list-item__meta--ellipsis, #searchUnRefList [data-type=search-item] .b3-list-item__meta--ellipsis, #searchAssetList [data-type=search-item] .b3-list-item__meta--ellipsis {\n    max-width: calc(100% - 22px);\n    padding: 6px 0 8px 8px;\n    line-height: 1;\n    float: right;\n    right: 0;\n    bottom: 12px;\n    color: #78dfff;\n}\n\n#searchList [data-type=search-item] .b3-list-item__text, #searchUnRefList [data-type=search-item] .b3-list-item__text, #searchAssetList [data-type=search-item] .b3-list-item__text {\n    line-height: 1;\n    -webkit-line-clamp: 1;\n    display: contents;\n}\n\n#searchList [data-type=search-item], #searchUnRefList [data-type=search-item], #searchAssetList [data-type=search-item] {\n    flex-wrap: wrap;\n    padding: 4px;\n    display: flow-root;\n    justify-content: none;\n}\n\n/* åŒ¹é…é€‰ä¸­é¢œè‰² */\n@supports (color: oklch(from red clamp(0, l * 0.5, 0.3) 0 h)) {\n    [data-theme-mode=dark] body:not(.has-exportimg) .protyle-wysiwyg [data-node-id] span[data-type~=search-mark].search-mark--hl {\n        box-shadow: 0 0 0 0.5px color(srgb 0 0.97 0.53), 0 13px 25px -2px color(srgb 0.08 0.83 0.53 / 0.4), 0 0 10px 0 rgb(from var(--b3-theme-accent) r g b / 0.2);\n    }\n}\n\n@supports (color: oklch(from red clamp(0, l * 0.5, 0.3) 0 h)) {\n    body:not(.has-exportimg) .protyle-wysiwyg [data-node-id] span[data-type~=search-mark].search-mark--hl {\n        background-color: oklch(0.73 0.22 149.52 / 0.38) !important;\n        box-shadow: 0 0 0 1px rgb(from var(--b3-theme-accent) r g b / 0.075), 0 13px 25px -2px rgb(from var(--b3-theme-accent) r g b / 0.075), 0 0 10px 0 rgb(from var(--b3-theme-accent) r g b / 0.075);\n    }\n}\n"
  },
  {
    "id": "20250816212926-0000027",
    "name": "pop_window-color_choice",
    "type": "css",
    "enabled": true,
    "content": ".protyle-util [style*=\"color:var(--b3-font-color\"] {\n    font-size: 1.5em;\n    background: #00000000;\n    border: none;\n}\n\n/* æ¸…é™¤å­—ä½“é¢œè‰²çš„ box æ ·å¼ */\n.color__square,\n.color__square:hover {\n    box-shadow: 0 0 0 0 inset var(--b3-border-color-trans);\n}\n\n/* å»é™¤æ— ç”¨çš„æŒ‰é’® */\n.protyle-util .protyle-font > div:nth-child(n+5):nth-child(-n+8),\n.protyle-util .protyle-font > div:nth-child(n+17):nth-child(-n+20) {\n    display: none;\n}\n\n/*å­—å·é€‰æ‹©*/\n.protyle-util .protyle-font > div:nth-child(21) {\n    display: inline;\n    font-size: 16px;\n    position: relative;\n    top: 3px;\n    left: 5px;\n\n    & label {\n        display: inline;\n        float: right;\n    }\n}\n\n/*æ¸…é™¤æ ·å¼*/\n.protyle-util .protyle-font > div:nth-child(24) {\n    & button {\n        width: 100%;\n        text-align: center;\n        right: -3px;\n    }\n\n\n    & svg {\n        display: none;\n    }\n}\n\n\ndiv.protyle-util .protyle-font > div:nth-child(23),\ndiv.protyle-util .protyle-font > div:nth-child(25) {\n    display: inline !important;\n    width: 120px;\n}\n\ndiv.protyle-util .protyle-font > div:nth-child(23) > select {\n    width: 120px;\n    margin-right: 4em;\n}\n\n.protyle-util .protyle-font {\n    max-width: none;\n}\n\n.protyle-font .b3-button {\n    border-radius: 7px;\n    padding: 4px 9px;\n    color: var(--b3-theme-on-background);\n    outline: 1px solid rgb(from var(--b3-theme-on-background) r g b / 0.2);\n    display: inline;\n    width: 103px;\n    position: relative;\n    right: 38px;\n    text-align: right;\n    font-size: 16px;\n}\n\n/* æ¸…é™¤æ ·å¼å†å²è®°å½•ä¼˜åŒ– */\n.protyle-font .b3-button svg {\n    top: 6px;\n    position: absolute;\n    left: 10px;\n}\n\nbutton.protyle-font__style[data-type=\"clear\"] {\n    font-size: 0;\n    line-height: 0;\n}\n\n.protyle-font > div:nth-child(15) > button::before,\n.protyle-font > div:nth-child(3) > button[aria-label=\"èƒŒæ™¯é¢œè‰²\"]::before {\n    content: \"A\";\n}\n"
  },
  {
    "id": "20250816212926-0000028",
    "name": "pop_window-emoji",
    "type": "css",
    "enabled": true,
    "content": "/*  è¿™æ®µä»£ç ä¼šå¯¼è‡´ä¸Šä¸‹é”®å¤±æ•ˆ æš‚æ—¶æ— è§£å†³æ–¹æ³• å…ˆå¼ƒç”¨\n.emojis__title[data-type=\"0\"],\n.emojis__title[data-type=\"1\"],\n.emojis__title[data-type=\"0\"] + div {\n    display: none;\n}\n*/\n\n/* é€‰ä¸­è¡¨æƒ… èƒŒæ™¯é¢œè‰² å®šä½å½“å‰è¡¨æƒ… */\n.emojis__item--current, .emojis__item:hover {\n    background: #6aace7 !important;\n}\n\n/* å•ä¸ªè¡¨æƒ…æ¡†çš„åœ†è§’ */\n.emojis__item {\n    border-radius: 6px;\n}\n"
  },
  {
    "id": "20250816212926-0000029",
    "name": "pop_window-slash_menu",
    "type": "css",
    "enabled": true,
    "content": "/* /èœå•å¼¹å‡ºæ¡† æœç´¢åç¬¬ä¸€ä¸ªå…ƒç´  å–æ¶ˆmargin-top */\n.protyle-hint.b3-list.b3-list--background.hint--menu > div > button:nth-child(1),\n.protyle-hint.b3-list.b3-list--background.hint--menu .b3-menu__separator + button .b3-list-item__first {\n    margin-top: 0;\n    border-top: 0.1px solid; /* è®¾ç½®ä¸‹è¾¹æ¡†çš„åšåº¦ */\n    border-color: transparent; /* è¾¹æ¡†é¢œè‰²è®¾ç½®ä¸ºé€æ˜ */\n    border-radius: 0;\n    line-height: 27px;\n}\n\n.protyle-hint.b3-list.b3-list--background.hint--menu > div > button {\n    margin-left: 6px;\n    margin-right: 0;\n}\n\n.protyle-hint.b3-list.b3-list--background.hint--menu .b3-menu__separator {\n    display: none;\n}\n"
  },
  {
    "id": "20250816212926-0000030",
    "name": "sidebar-filetree",
    "type": "css",
    "enabled": true,
    "content": "/* è®¾ç½®æ–‡æ¡£æ ‘å­—ä½“å¤§å° */\n.file-tree.fn__flex-1 {\n    font-size: 12px;\n}\n\n/* éšè—: æ–‡æ¡£æ ‘->æ–‡æ¡£->å›¾æ ‡\n/* .file-tree>.fn__flex-1>ul>li>span.b3-list-item__icon.b3-tooltips.b3-tooltips__e {display:contents;} æ˜¾ç¤ºç¬¬ä¸€å±‚çš„å›¾æ ‡*/\n.file-tree > .fn__flex-1 ul > li > span.b3-list-item__icon {\n    display: none;\n}\n\n/* éšè—: æ–‡æ¡£æ ‘->ç¬”è®°æœ¬->æ›´å¤šè®¾ç½®æŒ‰é’® */\n.file-tree > .fn__flex-1 > ul > li > span[data-type=\"more-root\"] {\n    display: none !important;\n}\n\n/* éšè—: æ–‡æ¡£æ ‘->æ–‡æ¡£-> æ›´å¤šè®¾ç½®æŒ‰é’® */\n.file-tree > .fn__flex-1 ul > li > span[data-type=\"more-file\"] {\n    display: none !important;\n}\n\n/* éšè—: æ–‡æ¡£æ ‘->æ–‡æ¡£->æ–‡æ¡£è¢«å¼•ç”¨ä¸ªæ•° */\n.file-tree .popover__block {\n    display: hidden !important;\n}\n\n/* éšè—æ–‡æ¡£æ ‘ç¼©è¿›çº¿ */\n.file-tree > .fn__flex-1 ul {\n    background-image: none !important;\n}\n\n/*.file-tree > .fn__flex-1 {\n    --indent-color-inactive: none;\n    --indent-color-active: none;\n}*/\n\n/* [CSSç‰‡æ®µ] æ–‡æ¡£æ ‘å‹ç¼©  */\n:root {\n    /* 22, 40, 58, 76, 94, 112, 130 */\n    --level-tree-compress-scale: 0.01;\n    --level-tree-compress-0: 2px;\n    --level-tree-compress-spacing: 1px;\n    --level-tree-compress-spacing-res: calc(var(--level-tree-compress-spacing) * var(--level-tree-compress-scale));\n\n    --level-tree-compress-2: calc(var(--level-tree-compress-0) + var(--level-tree-compress-spacing-res));\n    --level-tree-compress-3: calc(var(--level-tree-compress-2) + var(--level-tree-compress-spacing-res));\n    --level-tree-compress-4: calc(var(--level-tree-compress-3) + var(--level-tree-compress-spacing-res));\n    --level-tree-compress-5: calc(var(--level-tree-compress-4) + var(--level-tree-compress-spacing-res));\n    --level-tree-compress-6: calc(var(--level-tree-compress-5) + var(--level-tree-compress-spacing-res));\n    --level-tree-compress-7: calc(var(--level-tree-compress-6) + var(--level-tree-compress-spacing-res));\n    --level-tree-compress-8: calc(var(--level-tree-compress-7) + var(--level-tree-compress-spacing-res));\n\n    --file-tree-margin-left: 7px;\n}\n\n.file-tree > .fn__flex-1 > ul > ul > li > span.b3-list-item__toggle {\n    padding-left: var(--level-tree-compress-2) !important;\n    margin-left: var(--level-tree-compress-2) !important;\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > li > span.b3-list-item__toggle {\n    padding-left: var(--level-tree-compress-3) !important;\n    margin-left: var(--level-tree-compress-3) !important;\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > li > span.b3-list-item__toggle {\n    padding-left: var(--level-tree-compress-4) !important;\n    margin-left: var(--level-tree-compress-4) !important;\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > li > span.b3-list-item__toggle {\n    padding-left: var(--level-tree-compress-5) !important;\n    margin-left: var(--level-tree-compress-5) !important;\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > ul > li > span.b3-list-item__toggle {\n    padding-left: var(--level-tree-compress-6) !important;\n    margin-left: var(--level-tree-compress-6) !important;\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > ul > ul > li > span.b3-list-item__toggle {\n    padding-left: var(--level-tree-compress-7) !important;\n    margin-left: var(--level-tree-compress-7) !important;\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > ul > ul > ul > li > span.b3-list-item__toggle {\n    padding-left: var(--level-tree-compress-8) !important;\n    margin-left: var(--level-tree-compress-8) !important;\n}\n\n/* æ–‡æ¡£æ ‘ ç›®å½•é—´éš” */\n.file-tree .b3-list-item {\n    line-height: 20px;\n    min-height: 14px;\n    padding: 0 2px;\n    margin: 0 0;\n}\n\n/* æ–‡æ¡£æ ‘ æ¯ä¸€çº§è®¾ç½® */\n.file-tree .fn__flex-1 > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree .fn__flex-1 > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > ul > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n\n.file-tree > .fn__flex-1 > ul > ul > ul > ul > ul > ul > ul > ul > ul {\n    margin-left: var(--file-tree-margin-left);\n}\n"
  },
  {
    "id": "20250816212926-0000031",
    "name": "sidebar-main",
    "type": "css",
    "enabled": true,
    "content": "#protyle-sidebar {\n    top: 108px;\n}\n\n/* é€‰ä¸­é«˜äº® */\n.b3-list-item--focus .ariaLabel {\n    color: #00fd00 !important;\n}\n\n/* é€‰æ‹©çˆ¶å…ƒç´ é«˜äº® */\nli:has(+ ul .b3-list-item--focus) .b3-list-item__text {\n    color: red !important;\n    font-weight: 600 !important;\n}\n\n/* ç¼©å°æœ€å¤–é¢çš„å·¦è¾¹è· */\n.fn__flex.fn__flex-1 .b3-list-item {\n    margin-left: 0;\n}\n"
  },
  {
    "id": "20250816212926-0000032",
    "name": "sidebar-outline",
    "type": "css",
    "enabled": true,
    "content": "/* æ˜¾ç¤ºæ ‡é¢˜ */\n.sy__outline .b3-list-item[title] {\n    display: inherit;\n}\n\n/* å­—ä½“ å¤§å° æ¸…æ™°åº¦ */\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h1] .b3-list-item__text::before,\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h2] .b3-list-item__text::before,\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h3] .b3-list-item__text::before,\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h4] .b3-list-item__text::before,\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h5] .b3-list-item__text::before,\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h6] .b3-list-item__text::before {\n    font-size: 14px !important;\n    opacity: 1;\n    font-family: 'yahei consolas hybrid', 'ibm plex mono', serif;\n}\n\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h1] .b3-list-item__text::before {\n    content: \"â“µ\";\n    color: red;\n}\n\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h2] .b3-list-item__text::before {\n    content: \"ğŸ®\";\n    color: #0087ff;\n}\n\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h3] .b3-list-item__text::before {\n    content: \"ğŸ¯\";\n    color: #8694ff;\n}\n\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h4] .b3-list-item__text::before {\n    content: \"ğŸ’\";\n    color: #ffa54b;\n}\n\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h5] .b3-list-item__text::before {\n    content: \"ğŸ“\";\n    color: #9cfd57;\n}\n\n.sy__outline .b3-list-item[data-type=NodeHeading][data-subtype=h6] .b3-list-item__text::before {\n    content: \"â’\";\n    color: #e7fd1a;\n}\n"
  },
  {
    "id": "20250816212926-0000033",
    "name": "-block_ctrl_w_close_pin_tab",
    "type": "js",
    "enabled": true,
    "content": "// see https://ld246.com/article/1723109908986\n(() => {\n  // æ³¨å…¥æ ·å¼ï¼Œæ¨¡æ‹Ÿæ¿€æ´»æ ‡ç­¾çš„æ ·å¼ï¼Œå¯æ ¹æ®è‡ªå·±çš„æ ·å¼è¿›è¡Œè°ƒæ•´\n  addStyle(`\n        .layout__wnd--active .layout-tab-bar .item--pin--focus:after {\n            background-color: var(--b3-theme-primary);\n        }\n        .layout-tab-bar .item--pin--focus:after {\n            content: \"\";\n            width: 100%;\n            height: 3px;\n            border-radius: var(--b3-border-radius);\n            bottom: 0;\n            position: absolute;\n            background-color: var(--b3-theme-background-light);\n        }\n    `);\n\n  // æ˜¯å¦åœ¨æœ€è¿‘æ‰“å¼€æ–‡æ¡£å¯¹è¯æ¡†ä¸­ï¼Œå°†é’‰ä½æ ‡ç­¾ç§»åŠ¨åˆ°å½“å‰ç„¦ç‚¹çš„ä¸‹é¢ï¼Œé»˜è®¤ä¸ç§»åŠ¨ï¼Œæ”¹ä¸ºtrueæ—¶åˆ™ç§»åŠ¨\n  const isMovePinTabToFocusNextInRecentlyDialog = true;\n\n  // æ˜¯å¦åœ¨æ ‡ç­¾åˆ‡æ¢å¯¹è¯æ¡†ä¸­ï¼Œå°†é’‰ä½æ ‡ç­¾ç§»åŠ¨åˆ°å½“å‰ç„¦ç‚¹çš„ä¸‹é¢ï¼Œé»˜è®¤ä¸ç§»åŠ¨ï¼Œæ”¹ä¸ºtrueæ—¶åˆ™ç§»åŠ¨\n  const isMovePinTabToFocusNextInTabSwitchDialog = true;\n\n  //////////////// ä»¥ä¸‹ä»£ç ï¼Œä¸æ¶‰åŠæ ·å¼è°ƒæ•´ï¼Œéå¿…è¦å‹¿åŠ¨ //////////////////////\n\n  // ç­‰å¾…æ ‡ç­¾é¡µå®¹å™¨æ¸²æŸ“å®Œæˆåå¼€å§‹ç›‘å¬\n  whenElementExist('.layout__center').then(async element => {\n    // è®°å½•æŒ‰é”®å‰çš„æ•°æ®çŠ¶æ€\n    let originalValues = {};\n\n    // å½“æŒ‰ctrl+wæ—¶ï¼Œä¸´æ—¶ä¿®æ”¹item--focusä¸ºitem--pin--focus\n    document.addEventListener('keydown', function (event) {\n      if ((event.ctrlKey || event.metaKey) && event.key === 'w') {\n        // ä¸´æ—¶ä¿®æ”¹item--focusä¸ºitem--pin--focus\n        const focusPinTab = element.querySelector('.layout-tab-bar .item--pin.item--focus');\n        if (focusPinTab) {\n          focusPinTab.classList.remove('item--focus');\n          focusPinTab.classList.add('item--pin--focus');\n        }\n\n        // ä¸´æ—¶ä¿®æ”¹activetimeä¸º0ï¼Œå€¼ä¸º0å¯ä»¥é¿å…è¢«è·å¾—ç„¦ç‚¹\n        if (Object.keys(originalValues).length === 0) {\n          const items = element.querySelectorAll('.layout-tab-bar .item--pin');\n          let maxActivetimeItem = null;\n          let maxActivetime = 0;\n          items.forEach(item => {\n            originalValues[item.getAttribute(\"data-id\")] = item.dataset.activetime;\n            if (item.dataset.activetime > maxActivetime) {\n              maxActivetime = item.dataset.activetime;\n              maxActivetimeItem = item;\n            }\n            item.dataset.activetime = 0;\n          });\n          // æŠŠæœ€åæ¿€æ´»çš„æ–‡æ¡£è®¾ä¸ºä¸‹ä¸€ä¸ªç„¦ç‚¹\n          if (maxActivetimeItem) maxActivetimeItem.dataset.activetime = 1;\n        }\n      }\n    }, {capture: true});\n\n    // å½“æŒ‰é‡Šæ”¾æŒ‰é”®æ˜¯ï¼Œæ¢å¤item--pin--focusä¸ºitem--focus\n    document.addEventListener('keyup', function (event) {\n      // æ¢å¤item--pin--focusä¸ºitem--focus\n      const focusPinTab = element.querySelector('.layout-tab-bar .item--pin.item--pin--focus');\n      if (focusPinTab) {\n        focusPinTab.classList.remove('item--pin--focus');\n        focusPinTab.classList.add('item--focus');\n      }\n\n      // æ¢å¤activetimeçš„å€¼\n      if (Object.keys(originalValues).length > 0) {\n        const items = element.querySelectorAll('.layout-tab-bar .item--pin');\n        items.forEach(item => {\n          if (item.dataset.activetime <= 1) item.dataset.activetime = originalValues[item.getAttribute(\"data-id\")];\n        });\n        //æ¸…ç©ºoriginalValues\n        Object.keys(originalValues).forEach(key => {\n          delete originalValues[key];\n        });\n      }\n    }, true);\n\n    // ç›‘å¬æœ€è¿‘æ‰“å¼€æ–‡æ¡£ å’Œ é¡µç­¾åˆ‡æ¢\n    if (isMovePinTabToFocusNextInRecentlyDialog || isMovePinTabToFocusNextInTabSwitchDialog) {\n      observeDialogShow((node, dialog) => {\n        // ç›‘å¬æœ€è¿‘æ‰“å¼€æ–‡æ¡£\n        if (dialog === 'dialog-recentdocs') {\n          // è·å–æ‰€æœ‰é’‰ä½çš„æ ‡ç­¾\n          const pinTabNodeIds = getAllPinTabNodeIds();\n          // æŠŠæ‰€æœ‰æœ€è¿‘æ–‡æ¡£çš„é’‰ä½æ ‡ç­¾ï¼Œç§»åŠ¨åˆ°å½“å‰ç„¦ç‚¹çš„ä¸‹é¢\n          movePinTabItemToFocusTabNext(node, pinTabNodeIds);\n        }\n        // ç›‘å¬é¡µç­¾åˆ‡æ¢\n        if (dialog === 'dialog-switchtab') {\n          // è·å–æ‰€æœ‰é’‰ä½çš„æ ‡ç­¾\n          const pinTabNodeIds = getAllPinTabNodeIds();\n          // æŠŠæ‰€æœ‰æœ€è¿‘æ–‡æ¡£çš„é’‰ä½æ ‡ç­¾ï¼Œç§»åŠ¨åˆ°å½“å‰ç„¦ç‚¹çš„ä¸‹é¢\n          movePinTabItemToFocusTabNext(node, pinTabNodeIds);\n        }\n      });\n    }\n\n  });\n\n  // è·å–æ‰€æœ‰çš„æŒ‡å®šæ ‡ç­¾çš„nodeId\n  function getAllPinTabNodeIds() {\n    const pinTabs = document.querySelectorAll(\".layout__center .layout-tab-bar li.item--pin\");\n    let pinTabNodeIds = [];\n    pinTabs.forEach(pin => {\n      let initData = pin.getAttribute(\"data-initdata\");\n      if (initData) {\n        // åˆå§‹åŒ–æ—¶çš„æ•°æ®\n        initData = JSON.parse(initData);\n        if (initData && initData.blockId) {\n          pinTabNodeIds.push(initData.blockId);\n        }\n      } else {\n        // å†…å®¹åŠ è½½åçš„æ•°æ®\n        const dataId = pin.getAttribute(\"data-id\");\n        const parents = pin.closest(\"div.fn__flex\");\n        const nodeId = parents?.nextElementSibling?.querySelector('div[data-id=\"' + dataId + '\"] .protyle-breadcrumb__item svg.popover__block')?.getAttribute(\"data-id\");\n        if (nodeId) {\n          pinTabNodeIds.push(nodeId);\n        }\n      }\n    });\n    return pinTabNodeIds;\n  }\n\n  // ç§»åŠ¨æœ€è¿‘æ‰“å¼€æ–‡æ¡£æˆ–æ–‡æ¡£åˆ‡æ¢åˆ—è¡¨çš„node-idåœ¨pinTabNodeIdsä¸­çš„å…ƒç´ åˆ°å½“å‰ç„¦ç‚¹çš„ä¸‹é¢\n  async function movePinTabItemToFocusTabNext(node, pinTabNodeIds) {\n    let ulElement = null;\n    let focusElement = null;\n    await whenElementExist(() => {\n      ulElement = node.querySelector(\"ul.b3-list--background.fn__flex-1\");\n      focusElement = ulElement?.querySelector(\"li.b3-list-item--focus\");\n      return ulElement && focusElement;\n    });\n    pinTabNodeIds.reverse();\n    // éå† pinTabNodeIds æ•°ç»„\n    pinTabNodeIds.forEach(nodeId => {\n      // æŸ¥æ‰¾å…·æœ‰ç›¸åº” data-node-id çš„ li å…ƒç´ \n      const item = ulElement.querySelector(`li[data-node-id=\"${nodeId}\"]`);\n      if (item) {\n        // å°† item æ’å…¥åˆ° focusElement åé¢\n        focusElement.parentElement.insertBefore(item, focusElement.nextSibling);\n      }\n    });\n  }\n\n  // ç›‘å¬å¯¹è¯æ¡†\n  function observeDialogShow(callback) {\n    // åˆ›å»º MutationObserver å®ä¾‹\n    const observer = new MutationObserver((mutationsList) => {\n      for (let mutation of mutationsList) {\n        if (mutation.type === 'childList') {\n          // éå†æ–°å¢çš„å­å…ƒç´ \n          for (let node of mutation.addedNodes) {\n            if (node.nodeType === Node.ELEMENT_NODE && node.tagName.toLowerCase() === 'div') {\n              if (node.hasAttribute('data-key') && node.getAttribute('data-key') === 'dialog-recentdocs') {\n                if (typeof callback === 'function') callback(node, 'dialog-recentdocs');\n              }\n              if (node.hasAttribute('data-key') && node.getAttribute('data-key') === 'dialog-switchtab') {\n                if (typeof callback === 'function') callback(node, 'dialog-switchtab');\n              }\n            }\n          }\n        }\n      }\n    });\n    // é…ç½® MutationObserver\n    const config = {\n      childList: true,\n    };\n    // å¼€å§‹è§‚å¯Ÿ body çš„å­å…ƒç´ \n    observer.observe(document.body, config);\n    // observer.disconnect()\n  }\n\n  // å»¶è¿Ÿæ‰§è¡Œ\n  function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  // ç­‰å¾…å…ƒç´ æ¸²æŸ“å®Œæˆåæ‰§è¡Œ\n  function whenElementExist(selector) {\n    return new Promise(resolve => {\n      const checkForElement = () => {\n        let element = null;\n        if (typeof selector === 'function') {\n          element = selector();\n        } else {\n          element = document.querySelector(selector);\n        }\n        if (element) {\n          resolve(element);\n        } else {\n          requestAnimationFrame(checkForElement);\n        }\n      };\n      checkForElement();\n    });\n  }\n\n  // æ³¨å…¥æ ·å¼\n  function addStyle(styleContent) {\n    // è·å–ç°æœ‰çš„ <style> æ ‡ç­¾\n    let styleTag = document.head.querySelector('ctrl-w-not-close-tab-style');\n    // å¦‚æœå·²å­˜åœ¨ <style> æ ‡ç­¾\n    if (styleTag) {\n      // åˆ é™¤å·²å­˜åœ¨çš„ <style> æ ‡ç­¾\n      styleTag.parentNode.removeChild(styleTag);\n    }\n    // åˆ›å»ºæ–°çš„ <style> æ ‡ç­¾\n    styleTag = document.createElement('style');\n    styleTag.textContent = styleContent;\n    // å°†æ–°çš„ <style> æ ‡ç­¾æ·»åŠ åˆ°æ–‡æ¡£å¤´éƒ¨\n    document.head.appendChild(styleTag);\n  }\n})();\n"
  },
  {
    "id": "20250816212926-0000034",
    "name": "-change_link_to_mode",
    "type": "js",
    "enabled": true,
    "content": "(() => {\n  const style = document.createElement('style');\n  style.type = 'text/css';\n  style.innerHTML = 'span[data-type=\"url\"] { pointer-events: none; }';\n\n  let controlPressed = false;\n\n  document.addEventListener('keydown', (event) => {\n    if (event.key.toLowerCase() === 'control' && !controlPressed) {\n      controlPressed = true;\n      style.remove();\n    }\n  });\n\n  document.addEventListener('keyup', (event) => {\n    if (event.key.toLowerCase() === 'control' && controlPressed) {\n      controlPressed = false;\n      document.body.appendChild(style);\n    }\n  });\n\n  document.body.appendChild(style);\n})();\n"
  },
  {
    "id": "20250816212926-0000035",
    "name": "-collapse_code",
    "type": "js",
    "enabled": true,
    "content": "// ä»£ç å—æ·»åŠ æŠ˜å /å±•å¼€/å…¨å±/æ‚¬æµ®æ¨ªå‘æ»šåŠ¨æ¡\n// see https://ld246.com/article/1744373698945\n// æ”¯æŒåœ¨å—ä¸Šæ·»åŠ auto-heightè‡ªå®šä¹‰å±æ€§ï¼Œä½¿å—ä¸å—æœ€å¤§é«˜åº¦é™åˆ¶\n// version 0.0.5\n// 0.0.1 æ”¯æŒä»£ç å—çš„æŠ˜å å’Œå±•å¼€ï¼Œå…¨å±å’Œæ‚¬æµ®æ¨ªå‘æ»šåŠ¨æ¡\n// 0.0.2 ç¾åŒ–æ»šåŠ¨æ¡æ ·å¼\n// 0.0.3 ä¿®å¤å…¨å±åä»£ç å—æ˜¾ç¤ºä¸å…¨é—®é¢˜\n// 0.0.4 æ”¹è¿›ä»…ä»£ç å—æœ‰æ»šåŠ¨æ¡ä¸”å†…å®¹é«˜åº¦å¤§äºcodeMaxHeightæ—¶æ‰æ˜¾ç¤º\n// 0.0.5 ä¿®å¤æ–°å»ºä»£ç å—ä¸ä¼šç«‹åˆ»å‡ºç°æŠ˜å æ‰©å±•ç®­å¤´\n(() => {\n  // å½“ä»£ç å—å†…å®¹æœ€å¤§é«˜åº¦ï¼Œæ³¨æ„ï¼šè¿™é‡Œçš„é«˜åº¦æ˜¯æŒ‡.hljså…ƒç´ çš„é«˜åº¦ï¼Œé»˜è®¤æ˜¯500px\n  // æ”¯æŒåœ¨å—ä¸Šæ·»åŠ auto-heightè‡ªå®šä¹‰å±æ€§ï¼Œä½¿å—ä¸å—æœ€å¤§é«˜åº¦é™åˆ¶\n  const codeMaxHeight = '500px';\n\n  // æ˜¯å¦æ˜¾ç¤ºå…¨å±æŒ‰é’® true æ˜¾ç¤º false ä¸æ˜¾ç¤º\n  const isEnableFullscreen = false;\n\n  // æ˜¯å¦æ˜¾ç¤ºæ¨¡æ‹Ÿæ»šåŠ¨æ¡ true æ˜¾ç¤º false ä¸æ˜¾ç¤º\n  // è¯¥åŠŸèƒ½åœ¨ä»£ç å—åº•éƒ¨è¶…å‡ºå¯è§†åŒºåŸŸæ—¶è‡ªåŠ¨åœ¨åº•éƒ¨æ˜¾ç¤ºæ»šåŠ¨æ¡\n  const isEnableScrollbar = false;\n\n  // ä¸æ”¯æŒæ‰‹æœºç‰ˆï¼ˆå› ä¸ºæ‰‹æœºç‰ˆä¸éœ€è¦ï¼‰\n  if (isMobile()) return;\n\n  // æ·»åŠ æ ·å¼\n  addStyle(`\n        .b3-typography div.hljs, .protyle-wysiwyg .code-block:not([custom-auto-height]) div.hljs {\n            max-height: ${codeMaxHeight || '500px'};\n        }\n        .b3-typography .code-block:not(pre), .protyle-wysiwyg .code-block:not(pre){\n            margin: 2px 0; padding: 4px;\n        }\n        .b3-typography div.hljs, .protyle-wysiwyg div.hljs{\n                padding: 0.65em 1em 1.6em;\n        }\n        .b3-typography div.protyle-action, .protyle-wysiwyg .code-block div.protyle-action {\n            position: sticky;\n        }\n        /* å…¨å±èƒŒæ™¯è‰² */\n        :not(:root):fullscreen::backdrop {\n            background-color: var(--b3-theme-background);\n        }\n        /* æ¨¡æ‹Ÿæ»šåŠ¨æ¡å®¹å™¨ */\n        .scrollbar-container {\n          position: sticky;\n          bottom: 0;\n          width: 100%;\n          height: 8px;\n          /*background-color: #ddd;*/\n          cursor: pointer;\n          border-radius: 5px;\n          /*transition: opacity 0.3s ease;*/\n          z-index: ${++siyuan.zIndex || 9999};\n        }\n        /* æ»šåŠ¨æ¡æ»‘å— */\n        .scrollbar-thumb {\n          position: absolute;\n          top: 0;\n          left: 0;\n          height: 100%;\n          width: 20%; /* åˆå§‹æ»‘å—å®½åº¦ */\n          /*background-color: var(--b3-scroll-color);*/ /* light #C2C3C3 dark #4E4F58 */\n          box-shadow: inset 0 0 5px 5px var(--b3-scroll-color);\n          border-radius: 5px;\n          cursor: grab;\n        }\n        .scrollbar-container.f__hidden {\n          opacity: 0; /* éšè—å…ƒç´  */\n          pointer-events: none; /* ç¦ç”¨é¼ æ ‡äº¤äº’ */\n          height: 0;\n        }\n    `);\n\n  // ç›‘å¬ä»£ç å—è¢«åŠ è½½\n  whenElementExist('.layout__center, #editor').then(async el => {\n    // åŠ è½½æ—¶æ‰§è¡Œï¼ˆé™æ€åŠ è½½ï¼‰\n    let protyle;\n    await whenElementExist(() => {\n      protyle = el.querySelector('.protyle');\n      return protyle && protyle?.dataset?.loading === 'finished';\n    });\n    addCodeExtends(protyle.querySelectorAll('.code-block:not(:has(.protyle-icon--expand))'), protyle);\n\n    // æ»šåŠ¨æ—¶æ‰§è¡Œ\n    protyle.querySelector(\".protyle-content\").addEventListener('scroll', () => {\n      addCodeExtends(protyle.querySelectorAll('.code-block:not(:has(.protyle-icon--expand))'), protyle);\n    });\n\n    // ç›‘å¬protyleåŠ è½½äº‹ä»¶ï¼ˆåŠ¨æ€åŠ è½½ï¼‰\n    observeProtyleLoaded(el, protyles => {\n      protyles.forEach(async protyle => {\n        if (!protyle.classList.contains('protyle')) {\n          protyle = protyle.closest('.protyle');\n        }\n        // åŠ è½½æ—¶æ‰§è¡Œ\n        addCodeExtends(protyle.querySelectorAll('.code-block:not(:has(.protyle-icon--expand))'), protyle);\n\n        // æ»šåŠ¨æ—¶æ‰§è¡Œ\n        protyle.querySelector(\".protyle-content\").addEventListener('scroll', () => {\n          addCodeExtends(protyle.querySelectorAll('.code-block:not(:has(.protyle-icon--expand))'), protyle);\n        });\n      });\n    });\n  });\n\n  // æ·»åŠ æ‰©å±•æŒ‰é’®\n  let runing = false;\n  function addCodeExtends(codeBlocks, protyle) {\n    if (codeBlocks.length === 0) return;\n    if (runing) return;\n    runing = true;\n    setTimeout(() => { runing = false; }, 500);\n    codeBlocks.forEach(async code => {\n      if (code.querySelector('.protyle-icon--expand')) return;\n\n      // æ·»åŠ æŠ˜å æŒ‰é’®\n      const hljs = code.querySelector('.hljs');\n      if (!hljs) return;\n      let expandStatus = getExpandStatus(hljs);\n      const ariaLabel = getAriaLabelText(expandStatus);\n      const expandBtnHtml = `<span class=\"b3-tooltips__nw b3-tooltips protyle-icon protyle-icon--expand protyle-action__expand protyle-custom\" aria-label=\"${ariaLabel}\"><svg><use xlink:href=\"#${expandStatus}\"></use></svg></span>`;\n      const moreBtn = code.querySelector('.protyle-icon--last');\n      if (!moreBtn) return;\n      await whenElementExist(() => moreBtn.getAttribute('aria-label'));\n      moreBtn.insertAdjacentHTML('beforebegin', expandBtnHtml);\n      const expandBtn = code.querySelector('.protyle-icon--expand');\n      expandBtn.addEventListener('click', () => {\n        expandStatus = getExpandStatus(hljs);\n        if (expandStatus === 'iconDown') {\n          hljs.style.maxHeight = 'none';\n          expandStatus = 'iconUp';\n        } else {\n          hljs.style.maxHeight = codeMaxHeight;\n          expandStatus = 'iconDown';\n        }\n        const useEl = expandBtn.querySelector('svg > use');\n        useEl.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', '#' + expandStatus);\n        const ariaLabel = getAriaLabelText(expandStatus);\n        expandBtn.setAttribute('aria-label', ariaLabel);\n      });\n\n      // æ·»åŠ å…¨å±æŒ‰é’®\n      if (!isEnableFullscreen) return;\n      if (code.querySelector('.protyle-icon--fullscreen')) return;\n      let fullscreenAriaLabel = 'å…¨å±';\n      let fullscreenStatus = 'iconFullscreen';\n      const fullscreenBtnHtml = `<span class=\"b3-tooltips__nw b3-tooltips protyle-icon protyle-icon--fullscreen protyle-action__fullscreen protyle-custom\" aria-label=\"${fullscreenAriaLabel}\"><svg><use xlink:href=\"#${fullscreenStatus}\"></use></svg></span>`;\n      expandBtn.insertAdjacentHTML('beforebegin', fullscreenBtnHtml);\n      const fullscreenBtn = code.querySelector('.protyle-icon--fullscreen');\n      let oldCodeMaxHeight;\n      fullscreenBtn.addEventListener('click', () => {\n        if (fullscreenStatus === 'iconFullscreen') {\n          oldCodeMaxHeight = hljs.style.maxHeight;\n          requestFullScreen(code);\n          fullscreenStatus = 'iconFullscreenExit';\n          fullscreenAriaLabel = 'é€€å‡ºå…¨å±';\n          hljs.style.maxHeight = 'calc(100vh - 58px)';\n          expandBtn.style.display = 'none';\n          if (scrollbarContainer) scrollbarContainer.classList.add('f__hidden');\n        } else {\n          exitFullScreen(code);\n          fullscreenStatus = 'iconFullscreen';\n          fullscreenAriaLabel = 'å…¨å±';\n          if (oldCodeMaxHeight !== undefined) hljs.style.maxHeight = oldCodeMaxHeight;\n          expandBtn.style.display = '';\n          setTimeout(() => {\n            if (scrollbarContainer) scrollbarContainer.classList.add('f__hidden');\n          }, 300);\n        }\n        const useEl = fullscreenBtn.querySelector('svg > use');\n        useEl.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', '#' + fullscreenStatus);\n        fullscreenBtn.setAttribute('aria-label', fullscreenAriaLabel);\n      });\n\n      // æ·»åŠ æ¨¡æ‹Ÿæ»šåŠ¨æ¡\n      if (!isEnableScrollbar) return;\n      if (code.querySelector('.scrollbar-container')) return;\n      const scrollbarHtml = `<div class=\"scrollbar-container protyle-custom\"><div class=\"scrollbar-thumb\"></div></div>`;\n      code.insertAdjacentHTML('beforeend', scrollbarHtml);\n      const scrollbarContainer = code.querySelector('.scrollbar-container');\n      const protyleContent = protyle.querySelector(\".protyle-content\");\n\n      // æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºæ¨¡æ‹Ÿæ»šåŠ¨æ¡\n      function checkScrollbarVisibility() {\n        const hasHorizontalScrollbar = hljs.scrollWidth > hljs.clientWidth; // æ˜¯å¦æœ‰æ¨ªå‘æ»šåŠ¨æ¡\n        const isHeightExceeded = hljs.scrollHeight > parseHeightToPixels(codeMaxHeight); // é«˜åº¦æ˜¯å¦è¶…è¿‡codeMaxHeight\n        const isSticky = !isElementBottomInViewport(code); // æ˜¯å¦å¤„äº sticky çŠ¶æ€\n\n        if (hasHorizontalScrollbar && isHeightExceeded && isSticky) {\n          scrollbarContainer.classList.remove('f__hidden'); // æ˜¾ç¤ºæ¨¡æ‹Ÿæ»šåŠ¨æ¡\n        } else {\n          scrollbarContainer.classList.add('f__hidden'); // éšè—æ¨¡æ‹Ÿæ»šåŠ¨æ¡\n        }\n      }\n\n      // åˆå§‹åŒ–æ»šåŠ¨æ¡çŠ¶æ€\n      checkScrollbarVisibility();\n\n      // ç›‘å¬ protyleContent çš„æ»šåŠ¨äº‹ä»¶\n      protyleContent.addEventListener('scroll', () => {\n        checkScrollbarVisibility();\n      });\n\n      // æ¨¡æ‹Ÿæ»šåŠ¨æ¡æ»šåŠ¨\n      const scrollbarThumb = code.querySelector(\".scrollbar-thumb\");\n      let isDragging = false; // æ˜¯å¦æ­£åœ¨æ‹–åŠ¨\n      let startX, thumbStartX; // é¼ æ ‡æŒ‰ä¸‹æ—¶çš„åˆå§‹ä½ç½®\n\n      // è®¡ç®—æ»‘å—å®½åº¦å’Œæ»šåŠ¨æ¯”ä¾‹\n      function updateScrollbar() {\n        const contentWidth = hljs.scrollWidth;\n        const viewportWidth = hljs.clientWidth;\n        let thumbWidth = (viewportWidth / contentWidth) * scrollbarContainer.offsetWidth;\n        // è¾¹ç•Œå€¼å¤„ç†\n        thumbWidth = Math.max(thumbWidth, 10); // æœ€å°å®½åº¦ä¸º10px\n        scrollbarThumb.style.width = `${thumbWidth}px`;\n      }\n\n      // åŒæ­¥æ»šåŠ¨æ¡ä½ç½®\n      function syncScrollbarPosition() {\n        const scrollPercentage = hljs.scrollLeft / (hljs.scrollWidth - hljs.clientWidth);\n        const thumbMaxMove = scrollbarContainer.offsetWidth - scrollbarThumb.offsetWidth;\n        scrollbarThumb.style.left = `${scrollPercentage * thumbMaxMove}px`;\n      }\n\n      // åˆå§‹åŒ–æ»šåŠ¨æ¡\n      updateScrollbar();\n      syncScrollbarPosition();\n\n      // ç›‘å¬ .code-block çš„æ»šåŠ¨äº‹ä»¶\n      hljs.addEventListener(\"scroll\", () => {\n        syncScrollbarPosition();\n      });\n\n      // æ¨¡æ‹Ÿæ»šåŠ¨æ¡æ‹–åŠ¨é€»è¾‘\n      scrollbarThumb.addEventListener(\"mousedown\", (e) => {\n        isDragging = true;\n        startX = e.clientX;\n        thumbStartX = parseFloat(scrollbarThumb.style.left) || 0;\n        // ç¦ç”¨æ–‡æœ¬é€‰æ‹©\n        hljs.style.userSelect = \"none\";\n        // ç»‘å®šå…¨å±€äº‹ä»¶\n        document.addEventListener(\"mousemove\", handleMouseMove);\n        document.addEventListener(\"mouseup\", handleMouseUp);\n        // é˜»æ­¢é»˜è®¤è¡Œä¸º\n        e.preventDefault();\n      });\n\n      function handleMouseMove(e) {\n        if (!isDragging) return;\n        const deltaX = e.clientX - startX;\n        const thumbMaxMove = scrollbarContainer.offsetWidth - scrollbarThumb.offsetWidth;\n        let newThumbPosition = thumbStartX + deltaX;\n        // é™åˆ¶æ»‘å—èŒƒå›´\n        newThumbPosition = Math.max(0, Math.min(newThumbPosition, thumbMaxMove));\n        scrollbarThumb.style.left = `${newThumbPosition}px`;\n        // åŒæ­¥ .code-block çš„æ»šåŠ¨ä½ç½®\n        const scrollPercentage = newThumbPosition / thumbMaxMove;\n        hljs.scrollLeft = scrollPercentage * (hljs.scrollWidth - hljs.clientWidth);\n        // é˜»æ­¢é»˜è®¤è¡Œä¸º\n        e.preventDefault();\n      }\n\n      function handleMouseUp() {\n        isDragging = false;\n        // æ¢å¤æ–‡æœ¬é€‰æ‹©\n        hljs.style.userSelect = \"\";\n        // ç§»é™¤å…¨å±€äº‹ä»¶\n        document.removeEventListener(\"mousemove\", handleMouseMove);\n        document.removeEventListener(\"mouseup\", handleMouseUp);\n      }\n\n      // ç›‘å¬çª—å£å¤§å°å˜åŒ–\n      window.addEventListener(\"resize\", () => {\n        checkScrollbarVisibility();\n        updateScrollbar();\n        syncScrollbarPosition();\n      });\n    });\n  }\n\n  function requestFullScreen(element) {\n    if (element.requestFullscreen) {\n      element.requestFullscreen();\n    } else if (element.mozRequestFullScreen) { // Firefox\n      element.mozRequestFullScreen();\n    } else if (element.webkitRequestFullscreen) { // Chrome, Safari, Opera\n      element.webkitRequestFullscreen();\n    } else if (element.msRequestFullscreen) { // IE/Edge\n      element.msRequestFullscreen();\n    }\n  }\n\n  function exitFullScreen() {\n    if (document.exitFullscreen) {\n      document.exitFullscreen();\n    } else if (document.mozCancelFullScreen) { // Firefox\n      document.mozCancelFullScreen();\n    } else if (document.webkitExitFullscreen) { // Chrome, Safari, Opera\n      document.webkitExitFullscreen();\n    } else if (document.msExitFullscreen) { // IE/Edge\n      document.msExitFullscreen();\n    }\n  }\n\n  function getAriaLabelText(expandStatus) {\n    return expandStatus === 'iconDown' ? 'å±•å¼€' : 'æŠ˜å ';\n  }\n\n  function getExpandStatus(hljs) {\n    return getComputedStyle(hljs, null)?.maxHeight === codeMaxHeight ? 'iconDown' : 'iconUp';\n  }\n\n  function addStyle(css) {\n    // åˆ›å»ºä¸€ä¸ªæ–°çš„styleå…ƒç´ \n    const style = document.createElement('style');\n    // è®¾ç½®CSSè§„åˆ™\n    style.innerHTML = css;\n    // å°†styleå…ƒç´ æ·»åŠ åˆ°<head>ä¸­\n    document.head.appendChild(style);\n  }\n\n  function observeProtyleLoaded(el, callback) {\n    const config = { attributes: false, childList: true, subtree: true };\n    const observer = new MutationObserver((mutationsList, observer) => {\n      mutationsList.forEach(mutation => {\n        if (mutation.type === 'childList') {\n          // æŸ¥æ‰¾æ–°å¢åŠ çš„ NodeCodeBlock å…ƒç´ \n          const protyles = Array.from(mutation.addedNodes).filter(node =>\n            node.nodeType === Node.ELEMENT_NODE &&\n            (node.classList.contains('protyle') || node.classList.contains('protyle-content'))\n          );\n          // å¦‚æœæ‰¾åˆ°äº†è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è°ƒç”¨å›è°ƒå‡½æ•°\n          if (protyles.length > 0) {\n            callback(protyles);\n          }\n\n          // ç›‘å¬ä»£ç å—nodeè¢«åˆ›å»º\n          const codeBlocks = Array.from(mutation.addedNodes).filter(node =>\n            node.nodeType === Node.ELEMENT_NODE &&\n            (node.matches('.code-block:not(:has(.protyle-icon--expand))'))\n          );\n          if (codeBlocks.length > 0) {\n            addCodeExtends(codeBlocks, codeBlocks[0].closest('.protyle'));\n          }\n        }\n      });\n    });\n    // å¼€å§‹è§‚å¯Ÿ body ä¸‹çš„æ‰€æœ‰å˜åŒ–\n    observer.observe(el, config);\n    // å½“ä¸å†éœ€è¦è§‚å¯Ÿæ—¶å¯è°ƒç”¨æ–­å¼€æ¥åœæ­¢è§‚å¯Ÿ\n    return () => {\n      observer.disconnect();\n    };\n  }\n\n  // ç­‰å¾…å…ƒç´ æ¸²æŸ“å®Œæˆåæ‰§è¡Œ\n  function whenElementExist(selector, node) {\n    return new Promise(resolve => {\n      const check = () => {\n        const el = typeof selector === 'function' ? selector() : (node || document).querySelector(selector);\n        if (el) resolve(el); else requestAnimationFrame(check);\n      };\n      check();\n    });\n  }\n\n  function isMobile() {\n    return !!document.getElementById(\"sidebar\");\n  }\n\n  function isElementBottomInViewport(el) {\n    if (!el) return false; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å› false\n    const rect = el.getBoundingClientRect(); // è·å–å…ƒç´ çš„è¾¹ç•Œä¿¡æ¯\n    const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n    // åˆ¤æ–­å…ƒç´ çš„åº•éƒ¨æ˜¯å¦åœ¨è§†å£å†…\n    return rect.bottom <= windowHeight;\n  }\n\n  // é€šè¿‡å­—ç¬¦ä¸²è§£æå®é™…é«˜åº¦ï¼Œç¼“å­˜å¯¹è±¡ (ä½œä¸ºå‡½æ•°å±æ€§)\n  function parseHeightToPixels(value) {\n    // é™æ€ç¼“å­˜å¯¹è±¡ (å‡½æ•°å±æ€§)\n    if (!parseHeightToPixels.memo) {\n      parseHeightToPixels.memo = {};\n    }\n\n    // 1. æ•°å­—ç±»å‹ç›´æ¥è¿”å›\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    // 2. æ£€æŸ¥ç¼“å­˜\n    if (parseHeightToPixels.memo.hasOwnProperty(value)) {\n      return parseHeightToPixels.memo[value];\n    }\n\n    // 3. å¤„ç† px å•ä½æˆ–çº¯æ•°å­—å­—ç¬¦ä¸²\n    if (typeof value === 'string') {\n      // 3.1 çº¯æ•°å­—å­—ç¬¦ä¸² (å¦‚ '500')\n      if (/^\\d+\\.?\\d*$/.test(value)) {\n        const num = parseFloat(value);\n        parseHeightToPixels.memo[value] = num;\n        return num;\n      }\n\n      // 3.2 px å•ä½å­—ç¬¦ä¸² (å¦‚ '500px' æˆ– '300.5px')\n      if (value.toLowerCase().endsWith('px')) {\n        const num = parseFloat(value);\n        parseHeightToPixels.memo[value] = num;\n        return num;\n      }\n    }\n\n    // 4. å…¶ä»–å•ä½éœ€è¦ DOM è®¡ç®—\n    const tempDiv = document.createElement('div');\n    tempDiv.style.position = 'absolute';\n    tempDiv.style.visibility = 'hidden';\n    tempDiv.style.height = value;\n    tempDiv.style.left = '-9999px';\n\n    document.body.appendChild(tempDiv);\n    const heightInPixels = parseFloat(getComputedStyle(tempDiv).height);\n    document.body.removeChild(tempDiv);\n\n    // å­˜å…¥ç¼“å­˜\n    parseHeightToPixels.memo[value] = heightInPixels;\n    return heightInPixels;\n  }\n\n  let statusMsg;\n  function showStatusMsg(params, append = false) {\n    if (!statusMsg) statusMsg = document.querySelector('#status .status__msg');\n    params = typeof params === 'string' ? params : JSON.stringify(params);\n    let html = statusMsg.innerHTML;\n    if (append) {\n      html += params;\n    } else {\n      html = params;\n    }\n    html = html.trim();\n    statusMsg.innerHTML = html;\n  }\n})();\n"
  },
  {
    "id": "20250816212926-0000036",
    "name": "-Middle-click_to-expand_file_tree",
    "type": "js",
    "enabled": true,
    "content": "/* ä¸­é”®ç‚¹å‡»å±•å¼€æ–‡æ¡£æ ‘ JSç‰‡æ®µ */\n(async () => {\n  let g_reset = setInterval(main, 2000);\n\n  function main() {\n    if (document.querySelector('.sy__file')) {\n      clearInterval(g_reset);\n    } else {\n      return false;\n    }\n    document.querySelector('.sy__file').addEventListener('mousedown', event => {\n      if (event.button !== 1) return;\n      if (!event.target.classList.contains('b3-list-item__text'))\n        let target = event.target.parentNode;\n      let temp = event.target;\n      for (let i = 0; i < 4 && temp; i++) {\n        if (temp?.getAttribute(\"data-type\") === \"navigation-file\"\n          || temp?.getAttribute(\"data-type\") === \"navigation-root\") {\n          target = temp;\n          break;\n        }\n        temp = temp?.parentNode;\n      }\n      if (target?.getAttribute(\"data-type\") === \"navigation-file\"\n        || target?.getAttribute(\"data-type\") === \"navigation-root\") {\n        const b3ListItemToggle = target.querySelector('.b3-list-item__toggle');\n        const title = target.querySelector('.b3-list-item__text');\n        if (b3ListItemToggle.classList.contains('fn__hidden')) return;\n        event.preventDefault();\n        b3ListItemToggle.click();\n        if (event.ctrlKey) {\n          title.click();\n        }\n      }\n    }, true);\n  }\n})();\n"
  },
  {
    "id": "20250816212926-0000037",
    "name": "-slash_menu_arrow_keys_command",
    "type": "js",
    "enabled": true,
    "content": "/* from wilsons\nå½“å¼€å¯ç­›é€‰å, ä¸ºä¸ªäººä»£ç , å¦‚æœéœ€è¦å…¨éƒ¨ wilsons ä»£ç è¯·å…³æ³¨\nhttps://ld246.com/article/1724305128590/comment/1724740441386#comments\n*/\n\n// see https://ld246.com/article/1723539516115\n(() => {\n\n  // ä½¿ç”¨å…¼å®¹æ¨¡å¼ï¼Œ\n  // å¦‚æœå·¦å³ç®­å¤´æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å…¼å®¹æ¨¡å¼ï¼Œå…¼å®¹æ¨¡å¼ç”¨ctrl/cmd + æ–¹å‘é”®ç§»åŠ¨\n  // é»˜è®¤falseï¼Œæœªå¼€å¯ï¼Œè®¾ä¸ºtrueå¼€å¯\n  const useCompatibilityMode = false;\n\n  ////////////// ä»¥ä¸‹ä»£ç ä¸æ¶‰åŠé…ç½®é¡¹ï¼Œå¦‚æ— å¿…è¦å‹¿åŠ¨ //////////////////////////\n  // åˆ¤æ–­æ˜¯å¦Asriä¸»é¢˜\n  const theme = siyuan.config.appearance.mode === 0 ? siyuan.config.appearance.themeLight : siyuan.config.appearance.themeDark;\n  if (theme !== 'Asri') return;\n\n  // è®¾ç½®ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç„¦ç‚¹\n  function nextElementFocus(currentFocus, nextElement) {\n    currentFocus.classList.remove(\"b3-list-item--focus\");\n    nextElement?.classList.add(\"b3-list-item--focus\");\n  }\n\n\n  // ç­‰å¾…å…ƒç´ æ¸²æŸ“å®Œæˆåæ‰§è¡Œ\n  function whenElementExist(selector) {\n    return new Promise(resolve => {\n      const checkForElement = () => {\n        let element;\n        if (typeof selector === 'function') {\n          element = selector();\n        } else {\n          element = document.querySelector(selector);\n        }\n        if (element) {\n          resolve(element);\n        } else {\n          requestAnimationFrame(checkForElement);\n        }\n      };\n      checkForElement();\n    });\n  }\n\n  function monitorHintMenu(layoutCenter) {\n    // å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°å¤„ç† DOM å˜åŒ–\n    const observerCallback = (mutationsList) => {\n      mutationsList.forEach((mutation) => {\n        if (mutation.type === 'childList') {\n          // å½“ layout__center å…ƒç´ æœ‰æ–°çš„å­å…ƒç´ è¢«æ·»åŠ æˆ–åˆ é™¤æ—¶è§¦å‘\n          mutation.addedNodes.forEach((node) => {\n            if (node.classList && node.classList.contains('hint--menu')) {\n              // æ£€æŸ¥æ–°æ·»åŠ çš„èŠ‚ç‚¹æ˜¯å¦æ˜¯ .hint--menu\n              checkFnNoneClass(node);\n            }\n          });\n        } else if (mutation.type === 'attributes' && mutation.target.classList.contains('hint--menu')) {\n          // å½“ .hint--menu å…ƒç´ çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘\n          checkFnNoneClass(mutation.target);\n        }\n      });\n    };\n\n    // æ£€æŸ¥æ˜¯å¦æœ‰ .fn_none ç±»\n    function checkFnNoneClass(node) {\n      const hasFnNoneClass = node.classList.contains('fn__none');\n      if (!hasFnNoneClass) {\n        // æ˜¾ç¤ºmenu\n        hintMenuShow = true;\n        if (hintMenuTimer) clearTimeout(hintMenuTimer);\n      } else {\n        // éšè—menu\n        if (hintMenuTimer) clearTimeout(hintMenuTimer);\n        hintMenuTimer = setTimeout(() => {\n          hintMenuShow = false;\n        }, 100);\n      }\n    }\n\n    // é…ç½® MutationObserver\n    const config = {childList: true, subtree: true, attributes: true, attributeFilter: ['class']};\n\n    // åˆ›å»ºä¸€ä¸ªæ–°çš„ MutationObserver å®ä¾‹\n    const observer = new MutationObserver(observerCallback);\n\n    // å¼€å§‹è§‚å¯Ÿ layout__center å…ƒç´ \n    observer.observe(layoutCenter, config);\n\n    // è¿”å›ä¸€ä¸ªå‡½æ•°ä»¥åœæ­¢è§‚å¯Ÿ\n    return () => {\n      observer.disconnect();\n    };\n  }\n\n  // region group mode\n  // è·å–ä¸‹ä¸€ä¸ªåˆ†ç»„å…ƒç´ çš„ç„¦ç‚¹\n  function focusNextGroupButton() {\n    const menu = document.querySelector(\".hint--menu:not(.fn__none)\");\n    const currentFocus = menu.querySelector('.b3-list-item--focus');\n    let nextElement = currentFocus.nextElementSibling;\n\n    // ç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæŒ‰é’®æˆ–.b3-menu__separator\n    while (nextElement && nextElement.classList.contains('b3-list-item') && !nextElement.classList.contains('b3-menu__separator')) {\n      nextElement = nextElement.nextElementSibling;\n    }\n\n    // å¦‚æœæ‰¾åˆ°äº†.b3-menu__separatorï¼Œå°±èšç„¦åˆ°å®ƒçš„å‰ä¸€ä¸ªæŒ‰é’®\n    if (nextElement && nextElement.classList.contains('b3-menu__separator')) {\n      nextElement = nextElement.nextElementSibling;\n    }\n\n    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•æŒ‰é’®æˆ–.b3-menu__separatorï¼Œå¾ªç¯åˆ°åˆ—è¡¨å¼€å¤´\n    if (!nextElement || !nextElement.classList.contains('b3-list-item')) {\n      nextElement = menu.querySelector('.b3-list-item');\n    }\n\n    nextElementFocus(currentFocus, nextElement);\n  }\n\n  // è·å–ä¸Šä¸€ä¸ªåˆ†ç»„å…ƒç´ çš„ç„¦ç‚¹\n  function focusPreviousGroupButton() {\n    const menu = document.querySelector(\".hint--menu:not(.fn__none)\");\n    const currentFocus = menu.querySelector('.b3-list-item--focus');\n    let previousElement = currentFocus.previousElementSibling;\n\n    // ç»§ç»­æŸ¥æ‰¾ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæŒ‰é’®æˆ–.b3-menu__separator\n    while (previousElement && previousElement.classList.contains('b3-list-item') && !previousElement.classList.contains('b3-menu__separator')) {\n      previousElement = previousElement.previousElementSibling;\n    }\n\n    // å¦‚æœæ‰¾åˆ°äº†.b3-menu__separatorï¼Œå°±èšç„¦åˆ°å®ƒçš„å‰ä¸€ä¸ªæŒ‰é’®\n    if (previousElement && previousElement.classList.contains('b3-menu__separator')) {\n      previousElement = previousElement.previousElementSibling;\n    }\n\n    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•æŒ‰é’®æˆ–.b3-menu__separatorï¼Œå¾ªç¯åˆ°åˆ—è¡¨ç»“å°¾\n    if (!previousElement || !previousElement.classList.contains('b3-list-item')) {\n      previousElement = menu.querySelector('.b3-list-item:last-child');\n    }\n\n    nextElementFocus(currentFocus, getGroupFirstElement(previousElement));\n  }\n\n  // è·å–åˆ†ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ \n  function getGroupFirstElement(currentFocus) {\n    const menu = document.querySelector(\".hint--menu:not(.fn__none)\");\n    let previousElement = currentFocus.previousElementSibling;\n\n    // ç»§ç»­æŸ¥æ‰¾ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæŒ‰é’®æˆ–.b3-menu__separator\n    while (previousElement && previousElement.classList.contains('b3-list-item') && !previousElement.classList.contains('b3-menu__separator')) {\n      previousElement = previousElement.previousElementSibling;\n    }\n\n    // å¦‚æœæ‰¾åˆ°äº†.b3-menu__separatorï¼Œå°±èšç„¦åˆ°å®ƒçš„å‰ä¸€ä¸ªæŒ‰é’®\n    if (previousElement && previousElement.classList.contains('b3-menu__separator')) {\n      previousElement = previousElement.nextElementSibling;\n    }\n\n    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•æŒ‰é’®æˆ–.b3-menu__separatorï¼Œå¾ªç¯åˆ°åˆ—è¡¨ç»“å°¾\n    if (!previousElement || !previousElement.classList.contains('b3-list-item')) {\n      previousElement = menu.querySelector('.b3-list-item');\n    }\n    return previousElement;\n  }\n\n  // endregion group mode\n\n  // region search mode\n  function GetColData() {\n    const menu = document.querySelector(\".hint--menu:not(.fn__none)\");\n    const currentFocus = menu.querySelector('.b3-list-item--focus');\n    const parent = currentFocus.parentNode;\n    const b3ItemStyle = window.getComputedStyle(document.querySelector(\".hint--menu .b3-list-item\"))\n    const lineHeight = +b3ItemStyle.lineHeight.slice(0, -2)\n    const marginBottom = +b3ItemStyle.marginBottom.slice(0, -2)\n    // æ¯ä¸ªç»„æœ‰groupSizeä¸ªå…ƒç´ \n    const groupSize = Math.floor(menu.offsetHeight / (lineHeight + marginBottom))\n\n    // è®¡ç®—å½“å‰èšç„¦å…ƒç´ åœ¨å…¶çˆ¶å…ƒç´ ä¸­çš„ç´¢å¼•\n\n    const childrens = []\n    for (let children of parent.children){\n      if (children.classList && children.classList.contains(\"b3-menu__separator\")){\n      }else{\n        childrens.push(children)\n      }\n    }\n    const currentFocusIndex = Array.prototype.indexOf.call(childrens, currentFocus);\n    const totalGroup = Math.ceil(childrens.length / groupSize);\n    const curGroup = Math.ceil((currentFocusIndex + 1) / groupSize);\n    let rowNum = (currentFocusIndex + 1) % groupSize;\n    if (rowNum === 0) {\n      rowNum = groupSize;\n    }\n    return {\n      parent: parent, rowNum: rowNum, groupSize: groupSize, curGroup: curGroup, childrens:childrens,\n      totalGroup: totalGroup, currentFocusIndex: currentFocusIndex, currentFocus: currentFocus\n    }\n  }\n\n  function moveFocusByCol(isToRight) {\n    const data = GetColData();\n    let newFocusIndex;\n    if (data.curGroup === 1 && !isToRight) {\n      newFocusIndex = SkipMenuToEnd(data, data.childrens);\n    } else if (data.curGroup === data.totalGroup && isToRight) {\n      newFocusIndex = data.rowNum - 1;\n    } else if (data.curGroup === data.totalGroup - 1 && isToRight) {\n      newFocusIndex = SkipMenuToEnd(data, data.childrens);\n    } else {\n      newFocusIndex = data.currentFocusIndex + (isToRight ? data.groupSize : -data.groupSize);\n    }\n    nextElementFocus(data.currentFocus, data.childrens[newFocusIndex]);\n  }\n\n  function SkipMenuToEnd(data, childrens) {\n    let lastGroupButtonNum = childrens.length % data.groupSize;\n    if (lastGroupButtonNum === 0) {\n      lastGroupButtonNum = data.groupSize;\n    }\n    if (data.rowNum <= lastGroupButtonNum) {\n      return childrens.length + data.rowNum - lastGroupButtonNum - 1;\n    } else {\n      return childrens.length - 1;\n    }\n  }\n\n  // endregion search mode\n\n  // region key monitor\n  function AddKeyEventListener() {\n    document.addEventListener('keydown', function (event) {\n      let menu;\n      if (useCompatibilityMode) {\n        if (!(event.ctrlKey || event.metaKey)) return\n        menu = document.querySelector(\".hint--menu:not(.fn__none)\");\n      } else {\n        if (!hintMenuShow) return;\n        menu = document.querySelector(\".hint--menu\");\n        menu.classList.remove(\"fn__none\");\n      }\n      if (menu) Do(menu, event,)\n    });\n  }\n\n  function Do(menu, event) {\n    const sepEl = document.querySelector(\"div.b3-menu__separator\");\n    if (event.key === 'ArrowLeft' || (event.shiftKey && event.key === \"Tab\"))\n      sepEl ? focusPreviousGroupButton() : moveFocusByCol(false);\n    else if (event.key === \"ArrowRight\" || event.key === \"Tab\")\n      sepEl ? focusNextGroupButton() : moveFocusByCol(true);\n    else if (event.key === 'Escape' || event.key === \"Enter\")\n      menu.classList.add(\"fn__none\");\n    else return;\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  // endregion key monitor\n\n  // region Main\n  let hintMenuShow = false;\n  let hintMenuTimer = null;\n\n  // ç›‘æ§menuæ˜¾ç¤ºçŠ¶æ€\n  if (!useCompatibilityMode) {\n    whenElementExist('.layout__center').then(async element => {\n      monitorHintMenu(element); // ç­‰å¾…æ ‡ç­¾é¡µå®¹å™¨æ¸²æŸ“å®Œæˆåå¼€å§‹ç›‘å¬\n    });\n  }\n  // ç›‘å¬æŒ‰é”®\n  AddKeyEventListener()\n  // endregion Main\n})();\n"
  },
  {
    "id": "20250816212926-0000038",
    "name": "-smooth_cursor",
    "type": "js",
    "enabled": true,
    "content": "// æ€æºç¼–è¾‘å™¨è‡ªå®šä¹‰å…‰æ ‡\n// é¡ºæ»‘å…‰æ ‡+æ˜¯å¦é—ªçƒ+è‡ªå®šä¹‰æ ·å¼\n// ç›®å‰ä»…æ”¯æŒåœ¨ç¼–è¾‘å™¨ä¸­ä½¿ç”¨\n// todo æè‡´æ€§èƒ½ä¼˜åŒ–ï¼Œå¤ªå¤æ‚æš‚æ—¶ä¸å®ç°(å¯å‚è€ƒä¸‹æ–‡ä¼˜åŒ–è¯´æ˜)\n// see https://pipe.b3log.org/blogs/wilsons/%E6%80%9D%E6%BA%90/%E5%AE%9E%E6%97%B6%E8%8E%B7%E5%8F%96%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF\n// version 0.0.10.1\n// 0.0.10.1 ä¿®å¤æ‰‹æœºç‰ˆç‚¹å‡»å…‰æ ‡æ¶ˆå¤±é—®é¢˜\n// 0.0.10 é‡æ„å…‰æ ‡è·å–ç®—æ³•ï¼›ä¿®å¤å…‰æ ‡åœ¨è¡Œå†…å…¬å¼ç­‰ç‰¹æ®Šæƒ…å†µæ—¶å®šä½ä¸å‡†çš„é—®é¢˜ï¼›æ”¹è¿›å…‰æ ‡è·å–æ€§èƒ½ï¼›æ”¹è¿›æ ‡ç­¾åˆ‡æ¢ç­‰å‡ºç°æ„å¤–å…‰æ ‡\n// 0.0.9.2 ä¿®æ”¹å¤šå±‚æ»šåŠ¨æ¡åµŒå¥—ä¸‹çš„æ»šåŠ¨å»¶è¿Ÿé—®é¢˜ï¼›\n// 0.0.9.1 ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½\n// 0.0.9 ä¼˜åŒ–å…‰æ ‡æ’å…¥æ€§èƒ½\n// 0.0.8 ä¼˜åŒ–æ‹–åŠ¨æ—¶è®¡ç®—å…‰æ ‡ç®—æ³•\n// 0.0.7 ä¿®å¤ä¾§è¾¹æ æ‹–åŠ¨æ—¶ï¼Œå…‰æ ‡åªèƒ½ä¸´æ—¶è¢«éšè—çš„é—®é¢˜ï¼›å¢åŠ æ‰‹æœºç‰ˆæ”¯æŒå¼€å…³\n// 0.0.6 ä¿®å¤ä¾§è¾¹æ æ‹–åŠ¨åå…‰æ ‡å®šä½ä¸å‡†å’Œæ‚¬æµ®çª—æ‹–åŠ¨æ—¶ä¸èƒ½å®æ—¶å®šä½å…‰æ ‡é—®é¢˜\n// 0.0.5 æ”¹è¿›åœ¨å…‰æ ‡é—ªçƒæ—¶ï¼Œå½“ç§»åŠ¨/è¾“å…¥/ç‚¹å‡»æ—¶çš„ä¸è‡ªç„¶ï¼Œæœ‰å…‰æ ‡çªç„¶æ¶ˆå¤±æ„Ÿçš„é—®é¢˜ï¼›æ”¹è¿›æ»šåŠ¨æ—¶å…‰æ ‡æœ‰é—ªçƒçš„é—®é¢˜ï¼›å–æ¶ˆé€‰æ‹©æ–‡æœ¬æ˜¯çš„é¡ºæ»‘æ•ˆæœ\n// 0.0.4 ä¼˜åŒ–æ»‘åŠ¨é¼ æ ‡åŠ¨ç”»ï¼Œæ›´åŠ ä¸æ»‘\n// 0.0.3 ä¿®å¤æ‰‹åŠ¨æ‹–åŠ¨æ»šåŠ¨æ¡çš„bugå’Œæ”¹å˜å°ºå¯¸ç¼–è¾‘å™¨å’Œæ‹–åŠ¨æ‚¬æµ®çª—å£å…‰æ ‡åˆ·æ–°å»¶åé—®é¢˜å’Œå…‰æ ‡ä½ç½®åŠå¯è§åŒºåŸŸç»†èŠ‚è°ƒæ•´\n// 0.0.2 ä¿®å¤æ‰“å¼€å—ç­‰èœå•æ—¶ï¼Œå…‰æ ‡æ˜¾ç¤ºåœ¨èœå•ä¹‹ä¸Šçš„é—®é¢˜\n// see https://ld246.com/article/1747269101239 å‘å¸ƒå¸–\n// see https://ld246.com/article/1747200651209 éœ€æ±‚è´´\n(() => {\n  // æ˜¯å¦ä½¿ç”¨å…‰æ ‡é¡ºæ»‘åŠ¨ç”»æ•ˆæœ true ä½¿ç”¨é¡ºæ»‘å…‰æ ‡ false ä¸ä½¿ç”¨é¡ºæ»‘å…‰æ ‡\n  const isCursorSmoothEnabled = true;\n\n  // æ˜¯å¦ä½¿ç”¨å…‰æ ‡é—ªçƒåŠ¨ç”»æ•ˆæœ true é—ªåŠ¨ false ä¸é—ªåŠ¨\n  const isCursorBlinkEnabled = false;\n\n  // æ˜¯å¦ä¹Ÿåº”ç”¨äºæ–‡æ¡£æ ‡é¢˜ä¸­ true åº”ç”¨ false ä¸åº”ç”¨\n  const isApplyToTitle = true;\n\n  // è®¾ç½®å…‰æ ‡æ˜¯å…‰æ ‡æ‰€åœ¨å…ƒç´ è¡Œé«˜çš„å¤šå°‘å€ï¼Œç›¸å½“äºæŒ‰å…‰æ ‡æ‰€åœ¨æ–‡æœ¬è¡Œé«˜ç™¾åˆ†æ¯”è®¾ç½®å…‰æ ‡é«˜åº¦\n  const cursorHeightRelativeToLineHeight = 0.88;\n\n  // æ˜¯å¦åœ¨æ‰‹æœºç«¯ä½¿ç”¨ï¼Œå¦‚æœæ‰‹æœºç«¯å‡ºç°ä¸å…¼å®¹é—®æ—¶å¯ä»¥ç¦ç”¨æ‰‹æœºç«¯\n  // true ä½¿ç”¨ false ä¸ä½¿ç”¨\n  const isUseInMobile = true;\n\n  if(!isUseInMobile && isMobile()) return;\n\n  // å…¶ä»–å…‰æ ‡æ ·å¼ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ”¹ï¼Œé¢œè‰²ï¼Œå®½é«˜ä»€ä¹ˆçš„\n  addStyle(`\n        .protyle-wysiwyg{ caret-color: transparent; } /* éšè—ç¼–è¾‘å™¨é»˜è®¤å…‰æ ‡ */\n        ${isApplyToTitle ? `.protyle-title__input{caret-color: transparent;}`: ''} /* éšè—æ ‡é¢˜é»˜è®¤å…‰æ ‡ */\n        /* æ–°å…‰æ ‡æ ·å¼ */\n        #custom-cursor {\n          /* å…‰æ ‡å®½åº¦ */\n          width: 1.5px;\n          \n          /* é¢„è®¾å…‰æ ‡é«˜åº¦ï¼Œä¹Ÿå¯ä»¥è¿™é‡Œå†™æ­»ï¼Œä½†å†™æ­»ä¸åŒçš„å…ƒç´ å¯èƒ½æœ‰å·®å¼‚ï¼ˆè¿™é‡Œä¼˜å…ˆçº§é«˜äºåŠ¨æ€è®¡ç®—ï¼‰ */\n          /* è¿™é‡Œè¡Œé«˜ä»ç„¶å—cursorHeightRelativeToLineHeightçš„å½±å“ï¼Œå¦‚æœæƒ³ä¸å—å½±å“ï¼ŒæŠŠå€æ•°è®¾ä¸º1 */\n          /* height: 26px; */\n\n          /* å…‰æ ‡é¢œè‰² */\n          background: var(--b3-theme-on-background);\n\n          /* ä»¥ä¸‹æ ·å¼ï¼Œéå¿…è¦å‹¿æ”¹åŠ¨ */\n          position: fixed;\n          pointer-events: none;\n          transition: ${isCursorSmoothEnabled?'transform 0.15s cubic-bezier(0.25, 0.1, 0.25, 1)':'none'};\n          z-index: 1; /* è¿™ä¸ªä¼šå®æ—¶åŠ¨æ€è®¡ç®—ï¼Œè¿™é‡Œè®¾ç½®å¹¶ä¸èµ·ä½œç”¨ */\n          transform: translate(0, 0);\n          will-change: transform; /* å¯ç”¨ GPU åŠ é€Ÿ */\n          backface-visibility: hidden; /* é¿å…é‡ç»˜é—ªçƒ */\n          opacity: 1; /* é»˜è®¤ä¸é€æ˜ */\n        }\n        /* éšè—å…‰æ ‡ */\n        #custom-cursor.hidden {\n          opacity: 0 !important;\n          animation: none !important;\n          transition: none !important;\n        }\n        /* åœæ­¢å…‰æ ‡é—ªåŠ¨ */\n        #custom-cursor.no-animation {\n            animation: none !important;\n        }\n        /* åœæ­¢é¡ºæ»‘å…‰æ ‡æ•ˆæœ */\n        #custom-cursor.no-transition {\n          transition: none !important;\n        }\n        /* æ·»åŠ é—ªçƒåŠ¨ç”» */\n        ${isCursorBlinkEnabled ? `\n            #custom-cursor {\n              animation: cursor-blink 1s steps(2, jump-none) infinite;\n            }\n            @keyframes cursor-blink {\n              from { opacity: 0; }\n              to { opacity: 1; }\n            }\n        `:''}\n        /* ä¾§è¾¹æ æ‹–åŠ¨æ‰‹æŸ„ç¦æ­¢é€‰æ‹©ï¼Œé˜²æ­¢æ‹–åŠ¨æ—¶ï¼Œè¢«è¯¯æ’å…¥markeræ ‡è®°ï¼ˆç”¨äºè®¡ç®—å…‰æ ‡ä½ç½®ï¼‰ */\n        .layout__resize{user-select: none;}\n    `);\n\n  // æ’å…¥å…‰æ ‡å…ƒç´ å¹¶å¼€å¯å…‰æ ‡ç›‘å¬äº‹ä»¶\n  document.body.insertAdjacentHTML('beforeend', '<div id=\"custom-cursor\" class=\"hidden\"></div>');\n  addCursorEvent();\n\n  //////////// ä»¥ä¸‹åŠŸèƒ½å‡½æ•°éå¿…è¦å‹¿åŠ¨ /////////////\n  function addCursorEvent() {\n    const cursor = document.getElementById('custom-cursor');\n    let scrollTimeout = null;\n    let isUpdating = false;\n    let lastValidPos = null;\n    let lastScrollPos = { x: window.scrollX, y: window.scrollY };\n    let isFirstMove = true; // æ–°å¢é¦–æ¬¡ç§»åŠ¨æ ‡è®°\n    let blinkTimeout;\n    const BLINK_DELAY = 500; // é™æ­¢åå¼€å§‹é—ªçƒçš„å»¶è¿Ÿæ—¶é—´\n    //let editorLastLeft = 0;\n    let firstProtyleIds = [];\n    let currentDocId = '';\n    let hidePos = null;\n\n    // ä¼˜å…ˆè·å–å…‰æ ‡å…ƒç´ è‡ªèº«é¢„è®¾è¡Œé«˜\n    const cursorElement = document.getElementById('custom-cursor');\n    const cursorStyle = cursorElement ? window.getComputedStyle(cursorElement) : null;\n    const presetHeight = cursorStyle ? parseFloat(cursorStyle.height) : null;\n\n    // åˆ›å»ºå…¨å±€å”¯ä¸€ marker\n    const globalMarker = (() => {\n      const marker = document.createElement('span');\n      marker.textContent = '\\u200b';\n      marker.style.cssText = 'position: absolute; visibility: hidden; pointer-events: none;';\n      return marker;\n    })();\n\n    const handleScroll = () => {\n      // æ¸…é™¤é—ªçƒå¹¶åœæ­¢åç»­é—ªçƒ(æ»šåŠ¨æ—¶å¿…é¡»åœæ­¢åŠ¨ç”»ï¼Œä¸ç„¶åŠ¨ç”»æ•ˆæœä¼šè®©å…‰æ ‡æ‚¬æµ®å›ºå®šä¸åŠ¨)\n      if(blinkTimeout) clearTimeout(blinkTimeout);\n      cursor.classList.add('no-animation');\n      // æ¸…é™¤é¡ºæ»‘æ•ˆæœï¼Œé˜²æ­¢æ»šåŠ¨æ—¶ä¸Šä¸‹è·³åŠ¨\n      cursor.classList.add('no-transition');\n      updateCursor();\n      // clearTimeout(scrollTimeout);\n      // scrollTimeout = setTimeout(() => {\n      //     requestAnimationFrame(() => {\n      //         if (!isScrolling()) {\n      //             updateCursor();\n      //         }\n      //     });\n      // }, 200);\n    };\n\n    const isScrolling = () => {\n      const currentScrollPos = { x: window.scrollX, y: window.scrollY };\n      const isMoving = currentScrollPos.x !== lastScrollPos.x ||\n        currentScrollPos.y !== lastScrollPos.y;\n      lastScrollPos = currentScrollPos;\n      return isMoving;\n    };\n\n    // è·å–å…‰æ ‡ä½ç½®ï¼Œæ–°æ–¹æ¡ˆ\n    function getStablePosition() {\n      const sel = window.getSelection();\n      if (!sel.rangeCount) return null;\n\n      // å…‹éš†å¹¶ collapse Range\n      const range = sel.getRangeAt(0).cloneRange();\n      range.collapse(true);\n\n      // æ‰¾åˆ°å¯ç¼–è¾‘å®¹å™¨ï¼Œç”¨äºå–è¡Œé«˜\n      let hitNode = sel.focusNode;\n      if (hitNode.nodeType === Node.TEXT_NODE) hitNode = hitNode.parentElement;\n      const editableEl = hitNode.closest('[contenteditable=\"true\"]');\n      const style = editableEl ? window.getComputedStyle(editableEl) : null;\n      // ä¼˜å…ˆç”¨ line-heightï¼Œå¦åˆ™ fallback åˆ° font-size * 1.625 æˆ– 26px\n      const rawLineH = style && parseFloat(style.lineHeight)\n        || (style && parseFloat(style.fontSize) * 1.625)\n        || 26;\n      const lineH = rawLineH;\n      const paddingLeft = style ? parseFloat(style.paddingLeft) || 0 : 0;\n\n      // å°è¯•æµè§ˆå™¨åŸç”Ÿçš„ clientRects\n      const rects = Array.from(range.getClientRects());\n      let baseRect, x;\n      if (rects.length) {\n        baseRect = rects[rects.length - 1];\n      } else {\n        // å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯æ®µè½ç©ºè¡Œï¼Œæ®µè½ç©ºè¡Œç›´æ¥é€šè¿‡æ®µè½è·å–\n        const paragraph = findParentParagraph(range.startContainer);\n        if (paragraph && !paragraph.textContent.replace(/[\\u200B-\\u200D\\uFEFF]/g, '').trim()) {\n          baseRect = paragraph.getBoundingClientRect();\n          const style = window.getComputedStyle(paragraph);\n          x = baseRect.left + parseFloat(style.paddingLeft);\n        } else {\n          // å›é€€ï¼šæ’ marker æµ‹ä¸€æ¬¡\n          range.insertNode(globalMarker);\n          baseRect = globalMarker.getBoundingClientRect();\n          globalMarker.remove();\n        }\n      }\n\n      // è®¡ç®—é«˜åº¦ï¼šç»Ÿä¸€ç”¨è¡Œé«˜ * æ¯”ä¾‹\n      const height = lineH * cursorHeightRelativeToLineHeight;\n\n      // è®¡ç®— yï¼šæŠŠåŸç”Ÿ/marker è·å–çš„ rect.top å¯¹é½åˆ°è¡Œé«˜\n      // rectTop + (rect.height - height)/2  å¯èƒ½è®©å…‰æ ‡åœ¨å‚ç›´å±…ä¸­\n      const gap = (baseRect.height - height) / 2;\n      const y = baseRect.top + gap;\n\n      // x è´´åœ¨æ–‡å­—æœ«å°¾\n      x = x ? x : baseRect.right;\n\n      return baseRect.width + baseRect.height > 0 ? { x, y, height } : null;\n    }\n\n    // const getStablePosition = () => {\n    //     const sel = window.getSelection();\n    //     if (!sel.rangeCount) return null;\n\n    //     document.body.clientWidth; // å¼ºåˆ¶é‡ç»˜\n    //     const range = sel.getRangeAt(0).cloneRange();\n    //     range.collapse(true);\n\n    //     // ï¼ˆæš‚æ²¡ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼‰ä½¿ç”¨ä¼˜å…ˆçº§ï¼šå…‰æ ‡é¢„è®¾é«˜åº¦ > æ®µè½è¡Œé«˜ > é»˜è®¤20px\n    //     // const paragraph = findParentParagraph(range.startContainer);\n    //     // if (paragraph && !paragraph.textContent.replace(/[\\u200B-\\u200D\\uFEFF]/g, '').trim()) {\n    //     //     const rect = paragraph.getBoundingClientRect();\n    //     //     const style = window.getComputedStyle(paragraph);\n    //     //     const height = (presetHeight || parseFloat(style.lineHeight) || 26) * cursorHeightRelativeToLineHeight;\n    //     //     const topGap = (parseFloat(style.lineHeight) - height) / 2;\n    //     //     return {\n    //     //         x: rect.left + parseFloat(style.paddingLeft),\n    //     //         y: rect.top + parseFloat(style.paddingTop) + topGap,\n    //     //         height: height\n    //     //     };\n    //     // }\n\n    //     // const marker = document.createElement('span');\n    //     // marker.textContent = '\\u200b';\n    //     // marker.style.cssText = 'position: absolute; visibility: hidden; pointer-events: none;';\n    //     // range.insertNode(marker);\n    //     // const rect = marker.getBoundingClientRect();\n    //     // marker.remove();\n\n    //     range.insertNode(globalMarker);\n    //     const rect = globalMarker.getBoundingClientRect();\n    //     globalMarker.remove();\n\n    //     // æœ€ç»ˆé«˜åº¦é€»è¾‘ï¼šä¼˜å…ˆä½¿ç”¨å…‰æ ‡é¢„è®¾é«˜åº¦ï¼Œå¦åˆ™ç”¨å®é™…æµ‹é‡é«˜åº¦\n    //     const height = (presetHeight || rect.height)*cursorHeightRelativeToLineHeight;\n    //     const topGap = (rect.height - height) / 2;\n    //     return rect.width + rect.height > 0 ?\n    //         { x: rect.left, y: rect.top + topGap, height: height } :\n    //         null;\n    // };\n\n    const updateCursor = (event, eventType) => {\n      if (isUpdating) return;\n      isUpdating = true;\n\n      //requestAnimationFrame(() => {\n      const pos = hidePos ? hidePos : getStablePosition();\n      const output={cursorElement:null, isOuterElement: false};\n\n      if (!pos || !isInAllowElements(pos, output)) {\n        // ç¼–è¾‘å™¨å†…çš„å…ƒç´ ï¼Œä½†è¶…å‡ºç¼–è¾‘å™¨èŒƒå›´äº†éšè—\n        cursor.classList.add('hidden');\n        isUpdating = false;\n        //hidePos = pos;\n        return;\n      }\n\n      // å¦‚æœä¸æ˜¯ç¼–è¾‘å™¨åŒºåŸŸåˆ™éšè—å…‰æ ‡(é˜²æ­¢æ ‡ç­¾åˆ‡æ¢ç­‰å‡ºç°æ„å¤–å…‰æ ‡)\n      if(eventType === 'selectionchange') {\n        if(isMobile()) {\n          // const docId =  output.cursorElement?.closest('.protyle:not(.fn__none)')?.querySelector('.protyle-title')?.dataset?.nodeId;\n          // if(currentDocId !== docId) {\n          //     if(docId) currentDocId = docId;\n          //     cursor.classList.add('hidden');\n          //     isUpdating = false;\n          //     return;\n          // }\n        } else {\n          const protyleId = output.cursorElement?.closest('.protyle:not(.fn__none)')?.dataset?.id;\n          if(!firstProtyleIds.includes(protyleId)){\n            if(protyleId) firstProtyleIds.push(protyleId);\n            cursor.classList.add('hidden');\n            isUpdating = false;\n            return;\n          }\n        }\n      }\n\n      // ç‚¹å‡»éå¯ç¼–è¾‘åŒºåŸŸæ—¶ä¸åšä»»ä½•æ“ä½œï¼Œç›´æ¥è¿”å›\n      if(output.cursorElement && !output.cursorElement.closest('[data-node-id] [contenteditable=\"true\"]')) {\n        cursor.classList.add('hidden');\n        isUpdating = false;\n        return;\n      }\n\n      // æ¸…é™¤ä¹‹å‰çš„é—ªçƒå®šæ—¶å™¨\n      if(blinkTimeout) clearTimeout(blinkTimeout);\n      // ç§»é™¤é—ªçƒæ•ˆæœï¼ˆå½“å…‰æ ‡ç§»åŠ¨/è¾“å…¥/ç‚¹å‡»æ—¶ä¸éœ€è¦é—ªçƒï¼Œä¸ç„¶ä¼šæœ‰çªç„¶æ¶ˆå¤±æ„Ÿï¼‰\n      cursor.classList.add('no-animation');\n\n      // å¤„ç†é¦–æ¬¡ç§»åŠ¨\n      if (isFirstMove) {\n        cursor.classList.add('no-transition');\n        isFirstMove = false;\n      }\n\n      // å½“é€‰æ‹©æ–‡æœ¬æ—¶ï¼Œä¸éœ€è¦é¡ºæ»‘åŠ¨ç”»\n      if(eventType === 'selectionchange') {\n        const selection = window.getSelection();\n        if (selection.rangeCount > 0 && selection.toString()) {\n          cursor.classList.add('no-transition');\n        }\n      }\n\n      // æ‚¬æµ®çª—æ‹–åŠ¨çª—å£æ—¶ï¼Œå–æ¶ˆé¡ºæ»‘åŠ¨ç”»\n      if(['blockPopoverMove', 'protyleResize'].includes(eventType)) {\n        cursor.classList.add('no-transition');\n      }\n\n      // æ›´æ–°ä½ç½®å‰å¼ºåˆ¶æ¸…é™¤è¿‡æ¸¡\n      //const protyleContent = output.cursorElement?.closest('.protyle:not(.fn__none) .protyle-content');\n      //const editorRect = protyleContent.getBoundingClientRect();\n      // å…¼å®¹æ‹–åŠ¨ä¾§è¾¹æ ï¼Œé¼ æ ‡ä½ç½®+ç¼–è¾‘å™¨è¢«ç§»åŠ¨è·ç¦»ï¼ˆç§»åŠ¨è·ç¦»=å½“å‰ç¼–è¾‘å™¨left-ä¸Šæ¬¡ç¼–è¾‘å™¨leftï¼‰\n      // è¿™é‡Œè¿˜æœ‰å…¶ä»–çš„ç®—æ³•ï¼Œæ¯”å¦‚åœ¨æˆ–è€…å…‰æ ‡ä½ç½®æ—¶ç”¨ ç¼–è¾‘å™¨left-marker leftå¾—å‡ºç›¸å¯¹è·ç¦»ï¼Œç„¶åç”¨pos.x+ç›¸å¯¹è·ç¦»\n      //const realX = pos.x + (editorRect.left - (editorLastLeft||editorRect.left));\n      //editorLastLeft = editorRect.left;\n      cursor.style.transform = `translate(${pos.x}px, ${pos.y}px)`;\n      cursor.style.height = `${pos.height}px`;\n      cursor.classList.remove('hidden');\n      //hidePos = null;\n      cursor.style.zIndex = output.cursorElement ? getEffectiveZIndex(output.cursorElement) + 1 : ++window.siyuan.zIndex;\n\n      // å¼ºåˆ¶å¸ƒå±€åŒæ­¥\n      void cursor.offsetHeight;\n\n      // å»¶è¿Ÿæ¢å¤é¡ºæ»‘æ•ˆæœ\n      requestAnimationFrame(() => {\n        cursor.classList.remove('no-transition');\n      });\n\n      // å»¶è¿Ÿæ·»åŠ é—ªçƒæ•ˆæœï¼ˆå¾…å…‰æ ‡é™æ­¢åæ¢å¤é—ªçƒï¼‰\n      blinkTimeout = setTimeout(() => {\n        cursor.classList.remove('no-animation');\n      }, BLINK_DELAY);\n\n      lastValidPos = pos;\n      isUpdating = false;\n      //});\n    };\n\n    // æš‚æœªç”¨åˆ°\n    // const isInViewport = (pos) => {\n    //     return pos.y >= 0 &&\n    //            pos.y <= window.innerHeight &&\n    //            pos.x >= 0 &&\n    //            pos.x <= window.innerWidth;\n    // };\n\n    const isInAllowElements = (pos, output={cursorElement:null}) => {\n      const cursorElement = getCursorElement();\n      if(typeof output === 'object') output.cursorElement = cursorElement;\n\n      // åŠ¨æ€è·å–å½“å‰æ´»åŠ¨ç¼–è¾‘åŒºåŸŸ\n      let protyleContent = cursorElement?.closest('.protyle:not(.fn__none) .protyle-content');\n      // éç¼–è¾‘å™¨å†…çš„å…ƒç´ è¿”å›\n      if (!protyleContent) {\n        output.isOuterElement = true;\n        return false;\n      }\n      // å¦‚æœä¸åº”ç”¨äºæ ‡é¢˜è¿”å›\n      if(cursorElement.closest('.protyle-title__input') && !isApplyToTitle) return;\n\n      // è·å–ç¼–è¾‘åŒºåŸŸå¯è§†èŒƒå›´\n      const editorRect = protyleContent.getBoundingClientRect();\n\n      // æ£€æŸ¥åæ ‡æ˜¯å¦åœ¨ç¼–è¾‘åŒºåŸŸå¯è§†èŒƒå›´å†…\n      const isInEditor = pos.x >= editorRect.left &&\n        pos.x <= editorRect.right &&\n        pos.y >= editorRect.top &&\n        pos.y <= editorRect.bottom;\n\n      //è·å–æ»šåŠ¨å…ƒç´ \n      const scrollEl = findClosestScrollableElement(cursorElement);\n      // ä¸æ˜¯æ»šåŠ¨å…ƒç´ ç›´æ¥è¿”å›ç¼–è¾‘å™¨åŒºåŸŸ\n      if(protyleContent === scrollEl || !isSelfOrDescendant(protyleContent, scrollEl)) {\n        return isInEditor;\n      }\n      // è·å–æ»šåŠ¨å…ƒç´ åŒºåŸŸ\n      const scrollElRect = scrollEl.getBoundingClientRect();\n      const isInScrollEl = pos.x >= scrollElRect.left &&\n        pos.x <= scrollElRect.right &&\n        pos.y >= scrollElRect.top &&\n        pos.y <= scrollElRect.bottom;\n\n      // å¿…é¡»åœ¨æ»šåŠ¨å…ƒç´ å†…ä¸”ç¼–è¾‘å™¨å†…\n      return isInScrollEl && isInEditor;\n    };\n\n    // ç»™å…ƒç´ æ·»åŠ ç»‘å®šäº‹ä»¶\n    const checkElementEvents = () => {\n      const cursorElement = getCursorElement();\n      if(!cursorElement) return;\n      // ç»™å†…éƒ¨å¸¦æœ‰æ»šåŠ¨æ¡çš„å…ƒç´ æ·»åŠ æ»šåŠ¨äº‹ä»¶\n      const scrollEls = findClosestScrollableElements(cursorElement);\n      scrollEls.forEach(scrollEl => {\n        if(scrollEl && !scrollEl.handleClick) {\n          scrollEl.handleClick = handleScroll;\n          scrollEl.addEventListener('scroll', scrollEl.handleClick);\n          scrollEl.addEventListener('wheel', scrollEl.handleClick);\n        }\n      });\n      // ç»™protyle-contentç»‘å®šæ”¹å˜å°ºå¯¸äº‹ä»¶\n      const protyleContent = cursorElement?.closest('.protyle:not(.fn__none) .protyle-content');\n      if (protyleContent && !protyleContent.handleResize) {\n        new ResizeObserver(entries => {\n          updateCursor({target: protyleContent}, 'protyleResize');\n        }).observe(protyleContent);\n      }\n      // ç»™block__popoverç»‘å®šæ‹–åŠ¨äº‹ä»¶\n      const blockPopover = cursorElement?.closest('.block__popover');\n      if (blockPopover && !blockPopover.handleDrag) {\n        const dragEl = blockPopover.querySelector('.resize__move');\n        if(!dragEl) return;\n        blockPopover.handleDrag = true;\n        let isDragging = false;\n        dragEl.addEventListener('mousedown', function(e) {\n          isDragging = true;\n        });\n        dragEl.addEventListener('mousemove', function(e) {\n          if(isDragging) updateCursor(e, 'blockPopoverMove');\n        });\n        dragEl.addEventListener('mouseup', function(e) {\n          isDragging = false;\n        });\n      }\n    };\n\n    const events = [\n      ['scroll', () => handleScroll],\n      ['wheel', () => handleScroll],\n      ['touchmove', () => handleScroll],\n      ['selectionchange', (e)=>updateCursor(e, 'selectionchange'), { passive: true }],\n      ['keydown', () => requestAnimationFrame(updateCursor)],\n      ['input', () => requestAnimationFrame(updateCursor)],\n      ['click', (e) => {updateCursor(e, 'click');checkElementEvents();}],\n      ['compositionend', updateCursor],\n      ['mouseup', updateCursor],\n      ['resize', () => requestAnimationFrame(updateCursor), { passive: true }],\n      ['keyup', () => {checkElementEvents();}],\n    ];\n\n    events.forEach(([e, h, opts]) => {\n      document.addEventListener(e, h, opts);\n    });\n  }\n\n  function findParentParagraph(node) {\n    let current = node;\n    while (current && current !== document.body) {\n      if (current.dataset?.type === 'NodeParagraph') return current;\n      current = current.parentElement;\n    }\n    return null;\n  }\n\n  function getCursorElement() {\n    const selection = window.getSelection();\n    if (selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      // è·å–é€‰æ‹©èŒƒå›´çš„èµ·å§‹ä½ç½®æ‰€åœ¨çš„èŠ‚ç‚¹\n      const startContainer = range.startContainer;\n      // å¦‚æœèµ·å§‹ä½ç½®æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œè¿”å›å…¶çˆ¶å…ƒç´ èŠ‚ç‚¹\n      const cursorElement = startContainer.nodeType === Node.TEXT_NODE\n        ? startContainer.parentElement\n        : startContainer;\n\n      return cursorElement;\n    }\n    return null;\n  }\n\n  function addStyle(css) {\n    const style = document.createElement('style');\n    style.innerHTML = css;\n    document.head.appendChild(style);\n  }\n\n  // è·å–å®é™…ç”Ÿæ•ˆçš„z-index\n  function getEffectiveZIndex(element) {\n    let current = element;\n    while (current) {\n      const style = window.getComputedStyle(current);\n      const zIndex = style.zIndex;\n      const position = style.position;\n\n      // å¦‚æœæ˜¯æ ¹å…ƒç´ ï¼Œç›´æ¥è¿”å› 0\n      if (current === document.documentElement) return 0;\n\n      // åˆ¤æ–­å½“å‰å…ƒç´ æ˜¯å¦åˆ›å»ºäº†å±‚å ä¸Šä¸‹æ–‡\n      let isStackingContext = false;\n      // æ¡ä»¶1: position æ˜¯ fixed æˆ– stickyï¼ˆè‡ªåŠ¨åˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ï¼Œå³ä½¿ z-index æ˜¯ autoï¼‰\n      if (position === 'fixed' || position === 'sticky') {\n        isStackingContext = true;\n      }\n      // æ¡ä»¶2: position æ˜¯ absolute/relative ä¸” z-index é auto\n      else if ((position === 'absolute' || position === 'relative') && zIndex !== 'auto') {\n        isStackingContext = true;\n      }\n      // å…¶ä»–æ¡ä»¶ï¼ˆå¦‚ opacity < 1ã€transform ç­‰ï¼‰éœ€è¦é¢å¤–åˆ¤æ–­ï¼Œæ­¤å¤„æš‚æœªå®ç°\n\n      // å¦‚æœå½“å‰å…ƒç´ æ˜¯å±‚å ä¸Šä¸‹æ–‡ï¼Œè¿”å›å…¶ z-indexï¼ˆauto è§†ä¸º 0ï¼‰\n      if (isStackingContext) {\n        return zIndex === 'auto' ? 0 : parseInt(zIndex, 10);\n      }\n\n      current = current.parentElement;\n    }\n    return 0; // ç†è®ºä¸Šä¸ä¼šæ‰§è¡Œåˆ°æ­¤å¤„\n  }\n\n  function hasScroll(el) {\n    const style = getComputedStyle(el);\n    const canScrollY = (style.overflowY === 'scroll' || style.overflowY === 'auto')\n      && el.scrollHeight > el.clientHeight;\n    const canScrollX = (style.overflowX === 'scroll' || style.overflowX === 'auto')\n      && el.scrollWidth > el.clientWidth;\n    return canScrollY || canScrollX;\n  }\n\n  // æ£€æŸ¥æœ‰æ»šåŠ¨æ¡çš„çˆ¶å…ƒç´ ï¼Œè¿”å›æ‰€æœ‰\n  function findClosestScrollableElements(element) {\n    const scrollableElements = [];\n    while (element) {\n      if (hasScroll(element)) {\n        scrollableElements.push(element);\n      }\n      element = element.parentElement;\n    }\n    return scrollableElements;\n  }\n\n  // æ£€æŸ¥æœ‰æ»šåŠ¨æ¡çš„çˆ¶å…ƒç´ ï¼Œåªè¿”å›æœ€è¿‘ä¸€ä¸ª\n  function findClosestScrollableElement(element) {\n    while (element && element !== document.documentElement) {\n      if (hasScroll(element)) return element;\n      element = element.parentElement;\n    }\n\n    // æ˜¾å¼æ£€æŸ¥æ ¹å…ƒç´ \n    const roots = [document.body, document.documentElement];\n    for (const root of roots) {\n      if (hasScroll(root)) return root;\n    }\n\n    return null;\n  }\n\n  // æ£€æŸ¥æ˜¯å¦è‡ªèº«æˆ–åä»£\n  function isSelfOrDescendant(protyleContent, scrollEl) {\n    return protyleContent === scrollEl || protyleContent.contains(scrollEl);\n  }\n\n  function isMobile() {\n    return !!document.getElementById(\"sidebar\");\n  }\n})();\n"
  }
]